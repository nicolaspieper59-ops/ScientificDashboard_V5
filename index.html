<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>ARCHE V134 • QUANTUM ENTROPY</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/11.8.0/math.js"></script>
    <style>
        :root { --neon: #00ffcc; --gold: #ffcc00; --bg: #000; --quantum: #ff0055; }
        body, html { margin: 0; background: #000; color: var(--neon); font-family: 'JetBrains Mono', monospace; font-size: 8px; height: 100vh; overflow: hidden; }
        #cam-raw { display: none; }
        .master-hud { position: fixed; inset: 0; z-index: 100; display: grid; grid-template-columns: 300px 1fr 300px; padding: 15px; gap: 10px; }
        .panel { background: rgba(0, 5, 5, 0.95); border: 0.5px solid var(--neon); padding: 10px; backdrop-filter: blur(20px); }
        .title { color: var(--gold); font-weight: 900; border-bottom: 1px solid var(--gold); margin-bottom: 8px; font-size: 0.7rem; text-transform: uppercase; }
        .entropy-box { border: 1px solid var(--quantum); padding: 5px; color: var(--quantum); font-size: 0.65rem; word-break: break-all; min-height: 40px; }
        #v-big { font-size: 4rem; font-weight: 900; color: var(--gold); text-align: center; }
        canvas { border: 0.2px solid #333; width: 100%; height: 60px; }
    </style>
</head>
<body>

<video id="cam-source" autoplay playsinline style="display:none"></video>
<canvas id="entropy-canvas" width="64" height="64" style="display:none"></canvas>

<div class="master-hud">
    <div class="panel">
        <div class="title">Entropie du Vide (Quantum)</div>
        <button onclick="ARCHE.startQuantum()" style="width:100%; background:var(--quantum); border:none; padding:10px; font-weight:900; cursor:pointer;">PUISER DANS LE CHAOS</button>
        <div class="label" style="margin-top:10px;">Graine (Hash de Bruit Thermique)</div>
        <div id="q-seed" class="entropy-box">Prêt pour capture...</div>
        <div class="label">Bitrate d'Entropie</div>
        <div id="q-bitrate" class="val">0 bit/s</div>
        
        <div class="title" style="margin-top:20px;">Relativité S10e (No-GPS)</div>
        <div class="label">Vitesse Inertielle intégrée</div>
        <div id="v-inertial" class="val">0.000 m/s</div>
        <div class="label">Facteur γ (Lorentz)</div>
        <div id="gamma" class="val">1.000000000000</div>
    </div>

    <div style="display:flex; flex-direction:column; align-items:center; justify-content:center;">
        <div id="v-big">0.000</div>
        <div style="letter-spacing:10px; font-size:0.8rem;">INERTIAL REALITY</div>
        <canvas id="entropy-viz"></canvas>
    </div>

    <div class="panel">
        <div class="title">Sextant Temporel (Cosmos)</div>
        <div class="label">Décalage de Phase (Φ)</div>
        <div id="phase-shift" class="val" style="color:var(--quantum)">-- ms</div>
        <div class="label">Temps Solaire (TST)</div>
        <div id="tst-clock" class="val" style="color:var(--gold)">--:--:--</div>
        
        <div class="title" style="margin-top:20px;">Physique des Particules</div>
        <div class="label">Masse de l'Objet</div>
        <div class="val">70.00000000 kg</div>
        <div class="label">Énergie de Masse (E=mc²)</div>
        <div id="energy" class="val">-- Joules</div>
    </div>
</div>

<script type="module">
    import Astronomy from 'https://cdn.skypack.dev/astronomy-engine';

    const ARCHE = {
        state: { v: 0, lastA: 0, lastT: performance.now(), entropy: "" },

        async startQuantum() {
            const stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: "environment", width: 64, height: 64 } });
            document.getElementById('cam-source').srcObject = stream;
            
            // Initialisation de l'intégration inertielle (SANS GPS)
            window.addEventListener('devicemotion', (e) => this.integrateInertia(e));
            this.captureEntropy();
            this.loop();
        },

        integrateInertia(e) {
            const now = performance.now();
            const dt = (now - this.state.lastT) / 1000;
            const a = e.acceleration; 
            if(a && a.x !== null) {
                const mag = Math.sqrt(a.x**2 + a.y**2 + a.z**2);
                // Filtre passe-haut pour éliminer le drift statique
                if(mag > 0.1) this.state.v += mag * dt;
                else this.state.v *= 0.99; // Friction logic
            }
            this.state.lastT = now;
        },

        captureEntropy() {
            const video = document.getElementById('cam-source');
            const canvas = document.getElementById('entropy-canvas');
            const ctx = canvas.getContext('2d');
            
            setInterval(() => {
                ctx.drawImage(video, 0, 0, 64, 64);
                const data = ctx.getImageData(0, 0, 64, 64).data;
                // On extrait uniquement le bit de poids faible du canal rouge (bruit thermique)
                let noise = "";
                for(let i=0; i<data.length; i+=32) { noise += (data[i] & 1); }
                this.state.entropy = btoa(noise).substring(0, 32);
                document.getElementById('q-seed').innerText = this.state.entropy;
            }, 100);
        },

        loop() {
            setInterval(() => {
                const now = new Date();
                const obs = new Astronomy.Observer(43.2965, 5.3698, 0);
                
                // SEXTANT PURE
                const hourAngle = Astronomy.HourAngle("Sun", now, obs);
                const tstSeconds = ((hourAngle + 12) % 24) * 3600;
                document.getElementById('tst-clock').innerText = new Date(tstSeconds * 1000).toISOString().split('T')[1].split('.')[0];

                // PHYSIQUE SANS TRICHE
                const c = 299792458;
                const gamma = 1 / Math.sqrt(1 - (Math.pow(this.state.v, 2) / Math.pow(c, 2)));
                document.getElementById('v-inertial').innerText = this.state.v.toFixed(6) + " m/s";
                document.getElementById('v-big').innerText = (this.state.v * 3.6).toFixed(3);
                document.getElementById('gamma').innerText = gamma.toFixed(15);
                
                const e0 = 70 * Math.pow(c, 2);
                document.getElementById('energy').innerText = e0.toExponential(8);

            }, 100);
        }
    };
    window.ARCHE = ARCHE;
</script>
</body>
            </html>
