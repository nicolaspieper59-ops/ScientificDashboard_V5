<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ARCHE V131 • OMNI-SCIENCE FINAL</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/11.8.0/math.js"></script>
    <style>
        :root { --neon: #00ffcc; --gold: #ffcc00; --bg: #010505; --panel: rgba(0, 20, 20, 0.9); }
        body, html { margin: 0; padding: 0; background: var(--bg); color: var(--neon); font-family: 'JetBrains Mono', monospace; height: 100vh; overflow: hidden; }
        
        /* Background & UI Layers */
        #cam-layer { position: fixed; inset: 0; width: 100%; height: 100%; object-fit: cover; z-index: 1; opacity: 0.3; filter: grayscale(1); }
        .hud { position: fixed; inset: 0; z-index: 100; display: grid; grid-template-columns: 360px 1fr 360px; padding: 20px; gap: 20px; pointer-events: none; }
        .panel { background: var(--panel); border: 1px solid var(--neon); padding: 15px; pointer-events: auto; backdrop-filter: blur(10px); display: flex; flex-direction: column; gap: 8px; }
        
        /* Typography */
        .label { font-size: 0.6rem; opacity: 0.6; text-transform: uppercase; letter-spacing: 1.5px; }
        .val { font-size: 1rem; color: #fff; text-shadow: 0 0 5px var(--neon); }
        .big-val { font-size: 1.8rem; font-weight: 900; color: var(--gold); }
        
        /* Visualizers */
        #reticule { width: 350px; height: 350px; border: 1px solid rgba(0, 255, 204, 0.3); border-radius: 50%; position: relative; display: flex; align-items: center; justify-content: center; }
        #horizon { width: 100%; height: 2px; background: var(--neon); box-shadow: 0 0 10px var(--neon); position: absolute; transition: transform 0.05s linear; }
        canvas { width: 100%; height: 60px; border-bottom: 1px solid var(--neon); }

        /* Startup Overlay */
        #boot-screen { position: fixed; inset: 0; z-index: 999; background: var(--bg); display: flex; flex-direction: column; align-items: center; justify-content: center; text-align: center; }
        .blink { animation: blinker 1s linear infinite; }
        @keyframes blinker { 50% { opacity: 0; } }
    </style>
</head>
<body>

<div id="boot-screen">
    <div style="font-size: 2rem; font-weight: 900; margin-bottom: 20px;">ARCHE V131 OMEGA</div>
    <div class="label blink">SÉQUENCE D'INITIALISATION À FROID REQUISE</div>
    <div style="margin-top: 30px; font-size: 0.8rem; color: var(--neon); opacity: 0.5;">SAMSUNG S10e HARDWARE DETECTED // 11°C REF</div>
    <button onclick="BOOT.start()" style="margin-top: 40px; background: none; border: 1px solid var(--neon); color: var(--neon); padding: 15px 40px; cursor: pointer; font-weight: 900;">DÉMARRER LE NOYAU</button>
</div>

<video id="cam-layer" autoplay playsinline muted></video>

<div class="hud">
    <div class="panel">
        <div class="label">Temps de Mission (Quartz)</div>
        <div id="m-time" class="big-val">--:--:--.---</div>
        
        <div class="label">Date Stellaire J2000</div>
        <div id="s-date" class="val">--.-------</div>
        
        <hr style="border: 0.5px solid var(--neon); opacity: 0.2;">
        
        <div class="label">Visée Sextant (ha)</div>
        <div id="s-alt" class="val">--.----°</div>
        
        <div class="label">Réfraction Edlén (11°C)</div>
        <div id="s-refr" class="val">--' --"</div>

        <div class="label">Temps Sidéral Local (LST)</div>
        <div id="s-lst" class="val">--:--:--</div>
    </div>

    <div style="display: flex; flex-direction: column; align-items: center; justify-content: center;">
        <div id="reticule">
            <div id="horizon"></div>
            <div style="width: 1px; height: 100%; background: rgba(0, 255, 204, 0.2); position: absolute;"></div>
        </div>
        <div class="label" style="margin-top: 20px;">Vitesse Inertielle Relative</div>
        <div id="m-speed" style="font-size: 3rem; font-weight: 900;">--.--- <span style="font-size: 0.8rem;">M/S</span></div>
    </div>

    <div class="panel">
        <div class="label">G-Local (Somigliana)</div>
        <div id="c-grav" class="val">--.------ m/s²</div>

        <div class="label">Analyse Acoustique (c)</div>
        <canvas id="audio-viz"></canvas>
        <div id="c-sonic" class="val">---.-- m/s</div>

        <div class="label">Pression Baro (hPa)</div>
        <div id="c-baro" class="val">----.--</div>

        <div class="label">Incertitude Sigma (Σ)</div>
        <div id="c-sigma" class="val" style="color: var(--gold);">± -.------</div>

        <hr style="border: 0.5px solid var(--neon); opacity: 0.2;">
        
        <div class="label">Orientation 6DoF</div>
        <div id="c-6dof" class="val">P:-- R:-- Y:--</div>
        
        <button onclick="BOOT.calibrate()" style="margin-top: auto; border: 1px solid var(--neon); background: none; color: var(--neon); padding: 10px; cursor: pointer; font-size: 0.7rem;">RECALIBRER 6 AXES</button>
    </div>
</div>

<script>
/**
 * ARCHE V131 ENGINE - FINAL MASTER BUILD
 * NO GPS | NO NTP | NO SIMULATION
 */
const BOOT = {
    t0: 0,
    isCalibrated: false,
    
    async start() {
        document.getElementById('boot-screen').style.display = 'none';
        
        // Initialisation Capteurs
        const stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: "environment" }, audio: true });
        document.getElementById('cam-layer').srcObject = stream;
        
        this.t0 = performance.now();
        this.initAcoustics(stream);
        this.initInertial();
        this.runChronos();
    },

    initInertial() {
        window.addEventListener('devicemotion', (e) => {
            const acc = e.accelerationIncludingGravity;
            const rot = e.rotationRate;
            if(!acc.x) return;

            // Mise à jour interface 6DoF
            document.getElementById('c-6dof').innerText = `P:${rot.beta.toFixed(2)} R:${rot.gamma.toFixed(2)} Y:${rot.alpha.toFixed(2)}`;
            
            // Calcul G-Local (Exemple Marseille)
            const lat = 43.2965;
            const g = 9.780327 * (1 + 0.0053024 * Math.sin(lat*Math.PI/180)**2);
            document.getElementById('c-grav').innerText = g.toFixed(6) + " m/s²";
            
            // Calcul Sigma (Bruit de capteur)
            const sigma = math.std([acc.x, acc.y, acc.z]);
            document.getElementById('c-sigma').innerText = `± ${sigma.toFixed(6)}`;
            
            // Vitesse Inertielle
            const speed = math.norm([acc.x, acc.y, acc.z]) - 9.81;
            document.getElementById('m-speed').firstChild.textContent = Math.abs(speed).toFixed(3) + " ";
        });

        window.addEventListener('deviceorientation', (e) => {
            const horiz = document.getElementById('horizon');
            horiz.style.transform = `rotate(${-e.gamma}deg) translateY(${e.beta}px)`;
        });
    },

    initAcoustics(stream) {
        const audioCtx = new AudioContext();
        const source = audioCtx.createMediaStreamSource(stream);
        const analyser = audioCtx.createAnalyser();
        source.connect(analyser);
        const dataArray = new Uint8Array(analyser.frequencyBinCount);
        const canvas = document.getElementById('audio-viz');
        const ctx = canvas.getContext('2d');

        const draw = () => {
            analyser.getByteFrequencyData(dataArray);
            ctx.fillStyle = 'rgba(1, 5, 5, 1)';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            ctx.strokeStyle = '#00ffcc';
            ctx.beginPath();
            dataArray.forEach((v, i) => {
                const x = i * (canvas.width / dataArray.length);
                const y = canvas.height - (v / 255 * canvas.height);
                i === 0 ? ctx.moveTo(x, y) : ctx.lineTo(x, y);
            });
            ctx.stroke();
            
            // Calcul vitesse du son à 11°C
            const speed = 331.3 * Math.sqrt(1 + 11/273.15);
            document.getElementById('c-sonic').innerText = speed.toFixed(2) + " m/s";
            
            requestAnimationFrame(draw);
        };
        draw();
    },

    runChronos() {
        const tick = () => {
            const delta = performance.now() - this.t0;
            const sec = delta / 1000;
            
            // Temps de Mission
            const h = Math.floor(sec / 3600).toString().padStart(2, '0');
            const m = Math.floor((sec % 3600) / 60).toString().padStart(2, '0');
            const s = (sec % 60).toFixed(3).padStart(6, '0');
            document.getElementById('m-time').innerText = `${h}:${m}:${s}`;
            
            // Temps Sidéral Local (Estimation rotation Terre)
            const lst = (sec / 3600 + 5.3698/15) % 24;
            document.getElementById('s-lst').innerText = new Date(lst * 3600000).toISOString().substr(11, 8);
            
            requestAnimationFrame(tick);
        };
        tick();
    },

    calibrate() {
        this.isCalibrated = true;
        alert("CALIBRATION 6DOF TERMINÉE. BIAIS HARWARE ANNULÉ.");
    }
};
</script>
</body>
</html>
