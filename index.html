<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ARCHÈ X-13 | S10e MAX POTENTIAL</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs"></script>
    <style>
        body { margin: 0; background: #000; color: #00ffcc; font-family: 'Courier New', monospace; overflow: hidden; }
        canvas { display: block; position: absolute; top: 0; left: 0; z-index: 1; }
        #hud { position: absolute; top: 0; left: 0; z-index: 2; pointer-events: none; background: rgba(0,0,0,0.8); padding: 15px; width: 100%; height: 100%; box-sizing: border-box; display: flex; flex-direction: column; justify-content: space-between; }
        
        .header { display: flex; justify-content: space-between; border-bottom: 1px solid #333; padding-bottom: 10px; }
        .big-display { text-align: center; margin: 20px 0; }
        .big-val { font-size: 3.5em; font-weight: bold; color: #fff; text-shadow: 0 0 15px #00ffcc; }
        .label { font-size: 0.7em; color: #aaa; text-transform: uppercase; letter-spacing: 2px; }
        .data-val { color: #fff; font-weight: bold; }
        
        .status-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; font-size: 0.8em; }
        .alert { color: #ff3300; font-weight: bold; animation: blink 0.5s infinite; }
        @keyframes blink { 0%, 100% { opacity: 1; } 50% { opacity: 0; } }
        
        #audit { font-size: 9px; color: #555; background: rgba(0,0,0,0.5); padding: 5px; height: 60px; overflow: hidden; border: 1px solid #222; }
        .bar { height: 4px; background: #222; margin-top: 4px; width: 100%; position: relative; }
        .fill { height: 100%; background: #00ffcc; width: 0%; transition: width 0.1s; }
    </style>
</head>
<body>
    <div id="hud">
        <div class="header">
            <div>
                <div class="label">IDENTIFIANT</div>
                <div style="color:#00ffcc; font-weight:bold;">ARCHÈ X-13 // S10e</div>
            </div>
            <div style="text-align:right;">
                <div class="label">CONFIANCE SYSTÈME</div>
                <div id="trust" class="data-val">100%</div>
            </div>
        </div>

        <div class="big-display">
            <div class="label">Vitesse de Déplacement (m/s)</div>
            <div id="vel" class="big-val">0.0000</div>
            <div id="error" style="font-size:0.9em; color:#888;">±0.0000 m/s</div>
            <div id="phys-mode" class="mode-tag" style="margin-top:10px; font-size:0.8em; color:#ffcc00;">INITIALISATION...</div>
        </div>

        <div class="status-grid">
            <div>
                <div class="label">BIOME SENSORIEL</div>
                <div id="biome" class="data-val">DETECTION...</div>
            </div>
            <div>
                <div class="label">ENERGIE CINETIQUE</div>
                <div id="nrg" class="data-val">0.00 J</div>
            </div>
            <div>
                <div class="label">ACCÉLÉRATION (MAX 16G)</div>
                <div class="bar"><div id="bar-acc" class="fill"></div></div>
            </div>
            <div>
                <div class="label">BRUIT AMBIANT (MAX 130dB)</div>
                <div class="bar"><div id="bar-aud" class="fill"></div></div>
            </div>
        </div>

        <div>
            <div id="audit">LOGS: SYSTEM_ONLINE...</div>
            <div id="hash" style="font-size: 7px; opacity: 0.4; margin-top: 10px; word-break: break-all;">SHA-3: --</div>
        </div>
    </div>
    <canvas id="screen"></canvas>

<script>
// --- PARAMÈTRES PHYSIQUES RÉELS (S10e) ---
const LIMITS = {
    MAX_G: 156.96, // ±16g
    MAX_DB_VAL: 250, // Seuil de clipping numérique
    ISO_DARK: 5,
    MASS: 0.150 // Masse du S10e en kg
};

let sensors = { vel: 0, accel: 0, trust: 100, lastUpdate: Date.now() };
let video, audioCtx, analyser, dataArray, canvas, ctx, logs = [];
const startTime = Date.now();

// --- IA PINN OPTIMISÉE ---
const PINN = {
    model: null,
    async init() {
        this.model = tf.sequential({
            layers: [tf.layers.dense({units: 24, activation: 'tanh', inputShape: [1]}), tf.layers.dense({units: 1})]
        });
        this.opt = tf.train.adam(0.01);
    },
    async solve(t, a, rho) {
        if (a < 0.01) return sensors.vel * 0.98; // Amortissement naturel
        const loss = () => tf.tidy(() => {
            const time = tf.tensor1d([t]);
            const v = this.model.predict(time);
            const dvdt = tf.grad(t => this.model.predict(t))(time);
            const drag = tf.scalar(rho).mul(v.square()).mul(0.005);
            return dvdt.sub(tf.scalar(a).sub(drag)).square().mean();
        });
        await this.opt.minimize(loss);
        return this.model.predict(tf.tensor1d([t])).dataSync()[0];
    }
};

async function initSovereignty() {
    canvas = document.getElementById('screen'); ctx = canvas.getContext('2d');
    canvas.width = window.innerWidth; canvas.height = window.innerHeight;

    // Accès matériel avec réduction d'écho (mais sans retour HP)
    const stream = await navigator.mediaDevices.getUserMedia({ 
        video: { facingMode: "environment" }, 
        audio: { echoCancellation: false, autoGainControl: false, noiseSuppression: false } 
    });
    
    video = document.createElement('video'); 
    video.srcObject = stream; 
    video.muted = true; 
    video.play();

    audioCtx = new AudioContext();
    const source = audioCtx.createMediaStreamSource(stream);
    analyser = audioCtx.createAnalyser();
    
    // VERROU DE SILENCE : On connecte à l'analyseur mais JAMAIS à destination.
    source.connect(analyser); 

    dataArray = new Uint8Array(analyser.frequencyBinCount);

    window.addEventListener('devicemotion', e => {
        let acc = e.acceleration;
        if(acc) sensors.accel = Math.sqrt(acc.x**2 + acc.y**2 + acc.z**2);
    });

    await PINN.init();
    addLog("S10e_HARDWARE_CALIBRATED");
    loop();
}

function addLog(msg) {
    logs.unshift(`${new Date().toLocaleTimeString()} - ${msg}`);
    if(logs.length > 5) logs.pop();
    document.getElementById('audit').innerHTML = logs.join('<br>');
}

async function loop() {
    const now = Date.now();
    const dt = (now - sensors.lastUpdate) / 1000;
    const t = (now - startTime) / 1000;

    // Analyse Lumineuse
    ctx.drawImage(video, 0, 0, 10, 10);
    let pix = ctx.getImageData(0,0,10,10).data;
    let lum = 0; for(let i=0; i<pix.length; i+=4) lum += (pix[i]+pix[i+1]+pix[i+2])/3;
    lum /= 100;

    // Analyse Sonore
    analyser.getByteFrequencyData(dataArray);
    let noise = dataArray.reduce((a,b) => a+b, 0) / dataArray.length;
    let isClippedAudio = dataArray.some(v => v >= 255);
    let isVacuum = noise < 1.5;

    // --- LOGIQUE DE VÉRITÉ SOUVERAINE ---
    let mode = "NEWTON (AIR)";
    let errorRate = 0.001;
    let rho = isVacuum ? 0.0001 : 1.225;

    // Gestion des limites Hardware
    let isClippedAccel = sensors.accel > LIMITS.MAX_G;
    
    if (lum < LIMITS.ISO_DARK && isVacuum) {
        sensors.trust = Math.max(0, sensors.trust - 0.1);
        errorRate = 0.02;
        addLog("WARN: VOID_UNCERTAINTY");
    } else if (isClippedAccel || isClippedAudio || lum > 245) {
        sensors.trust = Math.max(0, sensors.trust - 0.5);
        errorRate = 0.05;
        addLog("ALERT: SENSOR_SATURATION");
        mode = "SATURATION";
    } else {
        sensors.vel = await PINN.solve(t, sensors.accel, rho);
        sensors.trust = Math.min(100, sensors.trust + 0.2);
    }

    if (sensors.vel < 0.06 && !isVacuum) mode = "STOKES (FLUIDE)";

    // --- MAJ INTERFACE ---
    document.getElementById('vel').innerText = sensors.vel.toFixed(4);
    document.getElementById('error').innerText = `±${(errorRate * t).toFixed(4)} m/s`;
    document.getElementById('biome').innerText = isVacuum ? "ESPACE/VIDE" : (lum < LIMITS.ISO_DARK ? "OBSCURITÉ" : "NOMINAL");
    document.getElementById('nrg').innerText = (0.5 * LIMITS.MASS * sensors.vel**2).toFixed(4) + " J";
    document.getElementById('trust').innerText = sensors.trust.toFixed(1) + "%";
    document.getElementById('trust').className = sensors.trust < 50 ? "alert" : "data-val";
    document.getElementById('phys-mode').innerText = mode;

    // Barres de Max Potential
    document.getElementById('bar-acc').style.width = Math.min(100, (sensors.accel / LIMITS.MAX_G)*100) + "%";
    document.getElementById('bar-aud').style.width = Math.min(100, (noise / 128)*100) + "%";
    
    document.getElementById('hash').innerText = "SHA-3: " + CryptoJS.SHA3(`${sensors.vel}-${mode}-${lum}`);

    // Rendu Visuel
    if (lum < LIMITS.ISO_DARK) {
        ctx.fillStyle = "black"; ctx.fillRect(0,0, canvas.width, canvas.height);
    } else {
        ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
        // Effet de grille scanline
        ctx.strokeStyle = "rgba(0, 255, 204, 0.1)";
        ctx.beginPath();
        for(let i=0; i<canvas.height; i+=20){ ctx.moveTo(0,i); ctx.lineTo(canvas.width,i); }
        ctx.stroke();
    }

    sensors.lastUpdate = now;
    requestAnimationFrame(loop);
}

document.body.onclick = () => { if(!audioCtx) initSovereignty(); };
</script>
</body>
</html>
