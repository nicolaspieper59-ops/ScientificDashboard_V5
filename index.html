<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>OMNISCIENCE V17 PRO MAX • TOTAL_HUD</title>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/11.8.0/math.js"></script>

    <style>
:root {
    --bg: #010101;
    --card: rgba(10, 10, 12, 0.98);
    --border: #1a1a20;
    --accent: #00ff88;
    --critical: #ff3300;
    --text: #e0e0e0;
}

* { box-sizing: border-box; margin: 0; padding: 0; outline: none; }

body {
    background: var(--bg);
    color: var(--text);
    font-family: 'JetBrains Mono', 'Courier New', monospace;
    /* Correction majeure : Dynamic Viewport Height */
    height: 100dvh; 
    width: 100vw;
    overflow: hidden;
    display: flex;
    flex-direction: column;
}

/* HEADER : Hauteur fixe garantie */
header#master-hud-fixed {
    height: 50px;
    min-height: 50px;
    background: #000;
    border-bottom: 2px solid var(--accent);
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 0 15px;
}

/* MAIN : Grille adaptative avec défilement interne */
main#master-hud-grid {
    flex: 1;
    display: grid;
    /* Passage en 2 colonnes sur mobile pour éviter l'écrasement horizontal */
    grid-template-columns: repeat(auto-fit, minmax(24%, 1fr));
    gap: 4px;
    padding: 4px;
    overflow-y: auto; /* Autorise le scroll si les données "éclatent" */
    scrollbar-width: none; /* Cache la scrollbar sur Firefox */
}
main::-webkit-scrollbar { display: none; } /* Cache la scrollbar sur Chrome/Safari */

/* FOOTER : La zone Espace-Temps et Mission Logs */
footer#sub-dashboard-row {
    height: 190px;
    min-height: 190px;
    display: grid;
    grid-template-columns: 1fr 1.5fr 1fr;
    gap: 4px;
    padding: 4px;
    background: #000;
    border-top: 1px solid #333;
}

.panel {
    background: var(--card);
    border: 1px solid var(--border);
    padding: 6px;
    display: flex;
    flex-direction: column;
    position: relative;
}

.panel h2 {
    font-size: 0.6rem;
    color: var(--accent);
    letter-spacing: 1px;
    border-bottom: 1px solid #222;
    margin-bottom: 4px;
    padding-bottom: 2px;
}

/* DATA POINTS : Alignement parfait des valeurs */
.data-point {
    display: flex;
    justify-content: space-between;
    align-items: baseline;
    font-size: 0.65rem; /* Légèrement agrandi pour le réalisme */
    margin-bottom: 2px;
    border-bottom: 1px solid rgba(255,255,255,0.02);
}

.data-point span:first-child { 
    color: #999; 
    font-size: 0.55rem;
    text-transform: uppercase;
}

.val-scientifique { 
    color: #fff; 
    font-weight: bold; 
    text-shadow: 0 0 3px rgba(0,255,136,0.3);
}

.unit { color: var(--accent); font-size: 0.5rem; opacity: 0.8; }

/* Correction des boutons pour éviter le débordement */
.control-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 2px;
}

#anomaly-log {
    flex: 1;
    font-size: 0.5rem;
    color: #00ccff; /* Couleur "Data Stream" */
    background: rgba(0,0,0,0.3);
    overflow-y: auto;
    font-family: monospace;
}

/* RESPONSIVE : Si l'écran est trop petit, on réduit le footer */
@media (max-height: 600px) {
    footer#sub-dashboard-row { height: 140px; min-height: 140px; }
    .panel h2 { font-size: 0.5rem; }
        }
        /* Style du terminal de données cachées */
#scientific-hidden-buffer {
    display: none; /* Caché par défaut */
    position: fixed;
    bottom: 25px; /* Juste au-dessus du footer */
    left: 0;
    width: 100%;
    height: 40vh; /* Prend 40% de l'écran */
    background: rgba(0, 5, 0, 0.95);
    border-top: 2px solid orange;
    z-index: 10000;
    overflow-y: auto;
    padding: 15px;
    font-size: 0.65rem;
    grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
    gap: 8px;
    backdrop-filter: blur(10px);
}

/* Affichage du nom de la variable devant chaque donnée */
#scientific-hidden-buffer span {
    display: block;
    color: #00ff88;
    border-bottom: 1px solid #222;
    padding-bottom: 2px;
}

#scientific-hidden-buffer span::before {
    content: attr(id) ": ";
    color: orange;
    font-weight: bold;
    text-transform: uppercase;
}

/* État actif */
#scientific-hidden-buffer.active {
    display: grid !important;
        }
    </style>
</head>
<body>

    <header id="master-hud-fixed">
        <div style="display:flex; align-items:center; gap:15px;">
            <i class="fas fa-microchip" style="color:var(--accent)"></i>
            <span style="font-weight:bold; font-size:0.8rem;">V17 PRO MAX</span>
            <span id="poi-alert" class="poi-active" style="display:none">⚠️ POI_DETECTED</span>
        </div>
        <div style="display:flex; gap:20px; font-size:0.65rem;">
            <div>STATUS: <span id="reality-status" style="color:var(--accent)">NOMINAL</span></div>
            <div>OFFSET: <span id="ntp-offset">--</span>ms</div>
            <div id="utc-datetime" class="val-scientifique">--:--:--</div>
        </div>
    </header>

    <main id="master-hud-grid">
        
        <div class="column">
            <section class="panel">
                <h2><i class="fas fa-terminal"></i> CENTRE_DE_COMMANDES</h2>
                <div style="display:grid; grid-template-columns:1fr 1fr; gap:4px; margin-bottom:5px;">
                    <button id="gps-pause-toggle">GPS_ACTIF</button>
                    <select id="freq-select" class="btn-v17" style="background:#111; color:var(--accent); border:1px solid #333; font-size:0.6rem;">
                        <option value="10">10Hz</option>
                        <option value="1">1Hz</option>
                    </select>
                    <button id="emergency-stop" style="color:var(--critical)">STOP</button>
                    <button id="reset-all-btn">RESET</button>
                </div>
                <div class="data-point"><span>Filtrage</span><select id="environment-select" style="background:#000; color:#fff; border:none; font-size:0.6rem;"><option>Normal</option><option>Centrifuge</option><option>OFF</option></select></div>
                <div class="data-point"><span>Réf. Gravité</span><select id="celestial-body-select" style="background:#000; color:#fff; border:none; font-size:0.6rem;"><option>EARTH</option></select></div>
                <div class="data-point"><span>Param. Station</span><span id="station-params">NOMINAL</span></div>
            </section>

            <section class="panel">
                <h2><i class="fas fa-project-diagram"></i> NAVIGATION_INERTIE</h2>
                <canvas id="ukf-canvas" style="height:40px;"></canvas>
                <div class="data-point"><span>Confiance Matrice P</span><span id="kalman-p-certainty">--</span>%</div>
                <div class="data-point"><span>Filtre Status</span><span id="filter-status" style="color:var(--accent)">READY</span></div>
                <div class="data-point"><span>Filtre Sec.</span><span id="filter-status-2">READY</span></div>
                <div class="data-point"><span>UKF Reactivity</span><span id="ukf-reactivity-mode">AUTO</span></div>
            </section>

            <section class="panel">
                <h2><i class="fas fa-gyroscope"></i> IMU_STABILISATION</h2>
                <div class="data-point"><span>Pitch / Roll</span><span><span id="pitch">--</span> / <span id="roll">-</span></span></div>
                <div class="data-point"><span>Acc. Filtrée</span><span id="f-acc-xyz" class="val-scientifique">-.--|-.--</span></div>
                <div class="data-point"><span>Biais Estimé</span><span id="bias-acc-val">--</span></div>
                <div class="data-point"><span>Gyro Bias</span><span id="bias-gyro-val">--</span></div>
            </div>
        </div>

        <div class="column">
            <section class="panel">
                <h2><i class="fas fa-rocket"></i> CINÉMATIQUE_PRO</h2>
                <div class="data-point" style="color:#00ffff"><span>V-COSMIQUE</span><span id="v-cosmic">--</span> km/h</div>
                <div class="data-point"><span>Stable (km/h)</span><span id="speed-stable-kmh" class="val-scientifique">--</span></div>
                <div class="data-point"><span>Stable (m/s)</span><span id="speed-stable-ms">--</span></div>
                <div class="data-point"><span>Vitesse Raw</span><span id="speed-raw-ms">--</span></div>
                <div class="data-point"><span>Vel-Z (EKF)</span><span id="vel-z-ekf">--</span></div>
                <div class="data-point"><span>V-Son Corrigée</span><span id="vitesse-son-cor">--</span></div>
                <div class="data-point"><span>Mach Number</span><span id="mach-number">--</span></div>
            </section>

            <section class="panel">
                <h2><i class="fas fa-infinity"></i> RELATIVITÉ_GÉNÉRALE</h2>
                <div class="data-point"><span>Lorentz (γ)</span><span id="ui-gamma" class="val-scientifique">1.000000</span></div>
                <div class="data-point"><span>Lorentz Total</span><span id="ui-lorentz">--</span></div>
                <div class="data-point"><span>Dilat. Temps (v)</span><span id="time-dilation">--</span> ns/s</div>
                <div class="data-point"><span>Dilat. Temps (g)</span><span id="time-dilation-gravite">--</span> ns/s</div>
                <div class="data-point"><span>E Relativiste</span><span id="relativistic-energy">--</span> J</div>
                <div class="data-point"><span>Schwarzschild</span><span id="schwarzschild-radius">--</span> m</div>
            </section>

            <section class="panel">
                <h2><i class="fas fa-bolt"></i> ÉNERGIE_&_QUANTUM</h2>
                <div class="data-point"><span>Masse Repos</span><span id="rest-mass-energy">--</span> J</div>
                <div class="data-point"><span>Momentum (p)</span><span id="momentum">--</span></div>
                <div class="data-point"><span>Quantum Drag</span><span id="quantum-drag">--</span></div>
                <div class="data-point"><span>C-Ratio</span><span id="ui-c-ratio">--</span></div>
            </section>
        </div>

        <div class="column">
            <section class="panel">
                <h2><i class="fas fa-location-dot"></i> POSITIONNEMENT_3D</h2>
                <div class="data-point"><span>LAT_UKF</span><span id="lat-ukf" class="val-scientifique">--</span></div>
                <div class="data-point"><span>LON_UKF</span><span id="lon-ukf" class="val-scientifique">--</span></div>
                <div class="data-point"><span>Alt Corrigée</span><span id="alt-display" class="val-scientifique">--</span></div>
                <div class="data-point"><span>Alt Baro</span><span id="alt-corrected-baro">--</span> m</div>
                <div class="data-point"><span>Dist. Cumulée</span><span id="dist-3d" style="color:var(--accent)">-- m</span></div>
            </section>

            <section class="panel">
                <h2><i class="fas fa-star"></i> ASTRO_WATCH</h2>
                <canvas id="mc-clock-canvas" style="height:40px;"></canvas>
                <div class="data-point"><span>Jour Julien</span><span id="ast-jd">--</span></div>
                <div class="data-point"><span>Temps Solaire</span><span id="tst-time">--</span></div>
                <div class="data-point"><span>Sidéral (TSLV)</span><span id="tslv">--</span></div>
                <div class="data-point"><span>Phase Lunaire</span><span id="moon-phase-name">--</span></div>
            </section>

            <section class="panel">
                <h2><i class="fas fa-eye"></i> HORIZON_DYNAMICS</h2>
                <div class="data-point"><span>Horizon (km)</span><span id="horizon-distance-km">--</span></div>
                <div class="data-point"><span>Visibilité</span><span id="horizon-target-visibility">--</span>%</div>
                <div class="data-point"><span>Terre Rayon</span><span id="earth-radius-local">--</span></div>
            </section>
        </div>

        <div class="column">
            <section class="panel">
                <h2><i class="fas fa-wave-square"></i> SIGNAL_PROCESSING</h2>
                <canvas id="ui-signal-wave" style="height:40px;"></canvas>
                <div class="data-point"><span>SNR Global</span><span id="ui-snr-db">--</span> dB</div>
                <div class="data-point"><span>GPS Accuracy</span><span id="ui-gps-accuracy">--</span> m</div>
                <div class="data-point"><span>Vrt Vibration</span><span id="ui-vrt">--</span> Hz</div>
            </section>

            <section class="panel" style="flex:1;">
                <h2><i class="fas fa-list"></i> MISSION_LOGS</h2>
                <div id="anomaly-log"></div>
                <div style="display:grid; grid-template-columns:1fr 1fr; gap:4px; margin-top:5px;">
                    <button id="clear-log-btn">CLEAR</button>
                    <button id="main-init-btn" onclick="startAdventure()" style="background:var(--accent); color:#000">START_V17</button>
                </div>
            </section>
        </div>

    </main>

    <footer id="sub-dashboard-row">
        
        <div class="panel" style="border-left: 2px solid var(--critical)">
            <h2><i class="fas fa-shield-virus"></i> SYSTÈME_CRITIQUE</h2>
            <div class="data-point"><span>Sync NTP</span><span id="ntp-status-val">--</span></div>
            <div class="data-point"><span>WiFi Latency</span><span id="wifi-latency">--</span>ms</div>
            <div class="data-point"><span>Batterie</span><span id="batt-level">--</span>%</div>
            <div class="data-point"><span>CPU Temp</span><span id="status-thermal-main">--</span></div>
            <div class="data-point"><span>Planck C.</span><span id="planck-const">6.626e-34</span></div>
        </div>

        <div class="panel" style="display:grid; grid-template-columns:repeat(3, 1fr); gap:10px;">
            <div>
                <h2>MÉCANIQUE</h2>
                <div class="data-point"><span>Pression Dyn.</span><span id="dynamic-pressure">--</span></div>
                <div class="data-point"><span>Reynolds (Re)</span><span id="reynolds-number">--</span></div>
                <div class="data-point"><span>Coriolis</span><span id="coriolis-force">--</span></div>
                <div class="data-point"><span>G Résultant</span><span id="g-force-resultant">--</span></div>
            </div>
            <div>
                <h2>BIO_SVT</h2>
                <div class="data-point"><span>Smoothness</span><span id="smoothness-score">--</span></div>
                <div class="data-point"><span>Adrénaline</span><span id="adrenaline-idx">--</span></div>
                <div class="data-point"><span>Kcal</span><span id="cal-val">--</span></div>
                <div class="data-point"><span>O2 Sat.</span><span id="O2-saturation">--</span>%</div>
            </div>
            <div>
                <h2>ATMOSPHÈRE</h2>
                <div class="data-point"><span>PM2.5 / 10</span><span id="pm25-val">--</span></div>
                <div class="data-point"><span>CAPE / UV</span><span id="ui-uv-index">--</span></div>
                <div class="data-point"><span>Humidité Abs</span><span id="abs-humidity">--</span></div>
                <div class="data-point"><span>Temp Rosée</span><span id="dew-point">--</span></div>
            </div>
        </div>

        <div class="panel" style="border-right: 2px solid var(--accent)">
            <h2><i class="fas fa-cloud-moon"></i> ESPACE_TEMPS_C</h2>
            <div class="data-point"><span>Dist. Lum (s)</span><span id="distance-light-s">--</span></div>
            <div class="data-point"><span>Dist. Lum (h)</span><span id="distance-light-h">--</span></div>
            <div class="data-point"><span>Sun Azimuth</span><span id="sun-azimuth">--</span></div>
            <div class="data-point"><span>Moon Alt</span><span id="moon-alt">--</span></div>
            <div class="data-point"><span>Delta T (ΔT)</span><span id="ast-deltat">--</span></div>
        </div>
        
    </footer>

    <div id="scientific-hidden-buffer" style="display:none;">
        <span id="ui-sampling-rate"></span><span id="ephem-status"></span>
        <span id="tslv"></span><span id="ui-lorentz"></span>
        <span id="gravity-theoretical"></span><span id="ui-f-arch"></span>
        <span id="ui-f-roll"></span><span id="no2-val"></span>
        <span id="o3-val"></span><span id="CAPE"></span>
        <span id="in-mass">80</span><span id="in-cx">0.4</span>
    </div>
         
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/11.8.0/math.js"></script>

<script src="lib/ephem.js"></script>
<script src="api/weather.js"></script>

<script src="lib/astro.js"></script>

    
<script src="gnss-dashboard-full.js"></script>                  
</body>
</html> 
