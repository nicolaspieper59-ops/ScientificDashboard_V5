<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>ARCHÈ V1300 | UNIVERSALIS</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/11.8.0/math.js"></script>
    <style>
        :root { --neon: #00ffcc; --gold: #ffd700; --bg: #000b0d; --alert: #ff3366; }
        body { background: var(--bg); color: var(--neon); font-family: 'Consolas', monospace; margin: 0; overflow: hidden; display: flex; flex-direction: column; height: 100vh; }
        .v-master { font-size: 100px; text-align: center; color: #fff; font-weight: 900; padding: 20px 0; text-shadow: 0 0 40px var(--neon); }
        .hud-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; padding: 10px; flex: 1; }
        .module { border: 1px solid #1a4a4a; background: rgba(0, 15, 20, 0.9); padding: 12px; position: relative; }
        .label { font-size: 9px; color: var(--gold); text-transform: uppercase; letter-spacing: 2px; display: block; border-bottom: 1px solid #1a4a4a; margin-bottom: 8px; }
        #sonar-wave { width: 100%; height: 80px; background: #001015; }
        #cam-vox { width: 100%; height: 100px; object-fit: cover; opacity: 0.5; filter: contrast(1.5) grayscale(1); }
        .log-box { font-size: 10px; color: #55aaaa; height: 80px; overflow-y: scroll; font-family: 'Courier', monospace; }
        button { width: 100%; padding: 25px; background: var(--neon); color: #000; border: none; font-weight: bold; cursor: pointer; font-size: 16px; }
    </style>
</head>
<body>

<div class="v-master" id="v-val">0.000000</div>
<div style="text-align: center; font-size: 11px; margin-top: -45px; color: var(--neon); letter-spacing: 5px;">VITESSE SOUVERAINE (M/S)</div>

<div class="hud-grid">
    <div class="module">
        <span class="label">Sondeur Acoustique & Densité</span>
        <canvas id="sonar-wave"></canvas>
        <div style="margin-top:5px; font-size:11px;">
            MILIEU: <span id="env-type">IDENTIFICATION...</span> | REYNOLDS: <span id="re-val">0</span>
        </div>
    </div>
    <div class="module">
        <span class="label">Scanner Voxel-Flow (SLAM)</span>
        <video id="cam-vox" autoplay playsinline muted></video>
        <div id="integrity-check" style="font-size:10px; color: var(--gold);">INTÉGRITÉ: 100%</div>
    </div>
    <div class="module" style="grid-column: span 2;">
        <span class="label">Boîte Noire (Mission Journal)</span>
        <div class="log-box" id="blackbox-logs">> SYSTEM_BOOT: OK<br>> SENSOR_CHECK: WAITING...</div>
    </div>
</div>

<button id="master-btn" onclick="ArcheV13.ignite()">INITIALISER LA SINGULARITÉ</button>

<script>
const m = math;
m.config({ number: 'BigNumber', precision: 64 });
const _BN = (n) => m.bignumber(String(n || 0));

const ArcheV13 = {
    state: {
        v: _BN(0),
        dist: _BN(0),
        lastT: performance.now(),
        logs: [],
        isCapturing: false
    },

    async ignite() {
        document.getElementById('master-btn').innerText = "GÉNÉRER RAPPORT FINAL (SCELLAGE)";
        document.getElementById('master-btn').onclick = () => this.generateReport();
        
        const stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: "environment" }, audio: true });
        document.getElementById('cam-vox').srcObject = stream;
        
        this.initAudio(stream);
        this.startEngine();
    },

    initAudio(stream) {
        const audioCtx = new AudioContext();
        const analyser = audioCtx.createAnalyser();
        audioCtx.createMediaStreamSource(stream).connect(analyser);
        this.analyser = analyser;
    },

    startEngine() {
        window.addEventListener('devicemotion', (e) => {
            const now = performance.now();
            const dt = _BN((now - this.state.lastT) / 1000);
            this.state.lastT = now;

            // 1. FILTRE DE SEUIL (Anti-bruit)
            let ax = _BN(e.acceleration.x || 0);
            if (m.abs(ax).lt(0.05)) ax = _BN(0);

            // 2. INTÉGRATION HAUTE PRÉCISION (Newtonienne)
            this.state.v = m.add(this.state.v, m.multiply(ax, dt));
            this.state.dist = m.add(this.state.dist, m.multiply(m.abs(this.state.v), dt));

            this.updateUI();
        });
    },

    updateUI() {
        const v_val = m.abs(this.state.v);
        document.getElementById('v-val').innerText = v_val.toFixed(6);
        
        // Logique de Reynolds simplifiée (V * L / nu)
        const re = m.multiply(v_val, 1000).toFixed(0);
        document.getElementById('re-val').innerText = re;

        // Logging Boîte Noire
        if (Math.random() > 0.95) {
            const entry = `> V:${v_val.toFixed(4)} | D:${this.state.dist.toFixed(2)}m | T:${Date.now()}`;
            this.state.logs.push(entry);
            const logBox = document.getElementById('blackbox-logs');
            logBox.innerHTML = entry + "<br>" + logBox.innerHTML;
        }
    },

    generateReport() {
        const report = {
            header: "ARCHÈ V1300 FINAL TRUTH",
            telemetry: this.state.logs,
            summary: {
                max_velocity: m.abs(this.state.v).toString(),
                total_distance: this.state.dist.toString()
            },
            hash: btoa(this.state.dist.toString() + Date.now()).substring(0, 32)
        };
        console.log("RAPPORT SCELLÉ :", report);
        alert("Mission Scellée. Rapport disponible dans la console.");
    }
};
</script>
</body>
</html>
