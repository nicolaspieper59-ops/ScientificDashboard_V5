<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>PROVIDENCE V19-S | SINGULARITY_CORE</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/11.8.0/math.js"></script>
    <script src="turf.min.js"></script>
    <script src="ephem.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Orbitron:wght@400;900&display=swap" rel="stylesheet">
    <style>
        :root { --glow: #00ff88; --bg: #020502; --warn: #ffcc00; --crit: #ff0044; --border: #004422; }
        * { box-sizing: border-box; }
        body { background: var(--bg); color: #e0ffe0; font-family: 'JetBrains Mono'; margin: 0; overflow: hidden; font-size: 10px; }
        
        /* HUD Layout */
        .hud-overlay { display: grid; grid-template-columns: 320px 1fr 320px; height: 100vh; padding: 15px; gap: 15px; }
        .panel { border: 1px solid var(--border); background: rgba(0, 10, 0, 0.9); padding: 15px; display: flex; flex-direction: column; backdrop-filter: blur(10px); }
        
        /* Typography */
        .v-main { font-size: 4rem; color: var(--glow); font-family: 'Orbitron'; text-shadow: 0 0 20px var(--glow); text-align: center; line-height: 1; }
        .data-label { color: #66aa66; font-size: 0.7rem; text-transform: uppercase; }
        .val { color: var(--glow); font-weight: bold; float: right; }
        .blink { animation: blinker 1.5s linear infinite; }
        @keyframes blinker { 50% { opacity: 0.2; } }

        /* Controls */
        #boot-btn { margin-top: auto; padding: 20px; background: var(--glow); border: none; font-family: 'Orbitron'; font-weight: 900; cursor: pointer; transition: 0.3s; }
        #boot-btn:hover { background: #fff; box-shadow: 0 0 30px var(--glow); }
        
        #console-log { font-size: 0.6rem; color: var(--warn); overflow-y: auto; height: 120px; border-top: 1px solid var(--border); padding-top: 10px; }
    </style>
</head>
<body>

<div class="hud-overlay">
    <aside class="panel">
        <h3 style="color:var(--glow)">[ASTRONOMICAL_TIME]</h3>
        <div class="data-row"><span class="data-label">JD_EPHEM</span><span id="ui-jd" class="val">2461065.5</span></div>
        <div class="data-row"><span class="data-label">LORENTZ_FACTOR (γ)</span><span id="ui-gamma" class="val">1.000000</span></div>
        <div class="data-row"><span class="data-label">PROPER_TIME (τ)</span><span id="ui-tau" class="val">0.000s</span></div>
        
        <h3 style="color:var(--glow); margin-top:25px">[CELESTIAL_3D]</h3>
        <div class="data-row"><span class="data-label">SUN_ALT_REFR</span><span id="ui-sun" class="val">0.00°</span></div>
        <div class="data-row"><span class="data-label">MOON_SYZYGY</span><span id="ui-moon" class="val">CALC...</span></div>
        <div id="ui-ecl-alert" class="blink" style="text-align:center; margin-top:15px; font-weight:900; color:var(--warn)">SCANNING_GRAVITY_LENS</div>
    </aside>

    <main class="panel" style="background:none; border:none; justify-content:center">
        <div style="background: rgba(0,0,0,0.8); padding: 30px; border: 1px solid var(--border); box-shadow: inset 0 0 50px rgba(0,255,136,0.1)">
            <div id="ui-speed-val" class="v-main">0.00</div>
            <div id="ui-speed-unit" style="text-align:center; letter-spacing:8px; margin-top:10px">METERS / SEC</div>
        </div>
        
        <div style="margin-top:30px; padding:15px; border-left: 2px solid var(--glow)">
            <div id="ui-pos-x">X: +0.000000000000000000</div>
            <div id="ui-pos-y">Y: +0.000000000000000000</div>
            <div id="ui-pos-z">Z: +0.000000000000000000</div>
        </div>
    </main>

    <aside class="panel">
        <h3 style="color:var(--glow)">[PROPORTIONAL_GEOM]</h3>
        <div class="data-row"><span class="data-label">TURF_RES</span><span id="ui-res" class="val">0.001m</span></div>
        <div class="data-row"><span class="data-label">MATH_PRECISION</span><span id="ui-prec" class="val">64 digits</span></div>
        <div class="data-row"><span class="data-label">GEOID_ALT (N)</span><span id="ui-geoid" class="val">48.25m</span></div>

        <h3 style="color:var(--glow); margin-top:25px">[SINGULARITY_LOG]</h3>
        <div id="console-log">
            > KERNEL_IDLE<br>
            > AWAITING_BOOT_SEQUENCE...
        </div>
        <button id="boot-btn" onclick="PROVIDENCE.boot()">INIT_UNIVERSAL_SYNC</button>
    </aside>
</div>

<script>
// Initialisation Math.js en BigNumber pour la précision "Zéro Triche"
math.config({ number: 'BigNumber', precision: 64 });

const PROVIDENCE = {
    C: 299792458, // Célérité lumière
    state: {
        active: false,
        v: 0, 
        pos: { x: math.bignumber(0), y: math.bignumber(0), z: math.bignumber(0) },
        jd: 2461065.5, // Temps Ephem.js (Jour Julien)
        tau: 0, // Temps propre (Relativité)
        lastTick: performance.now()
    },

    async boot() {
        this.log("BOOTING_SINGULARITY_CORE...");
        this.state.active = true;
        document.getElementById('boot-btn').style.display = 'none';
        
        // Activation capteurs inertiels
        window.addEventListener('devicemotion', (e) => this.processPhysics(e));
        
        this.log("SENSORS_ARMED");
        this.log("EPHEM.JS_CLOCK_SYNCED");
        this.run();
    },

    // 1. MOTEUR DE PROPORTIONNALITÉ (De l'escargot à l'année-lumière)
    getScale(v) {
        // Résolution spatiale Turf.js (mètres) : v=0.01 (escargot) -> 1mm | v=1000 -> 10m
        const res = Math.max(0.001, v / 100);
        // Facteur de Lorentz (Dilatation du temps)
        const beta = Math.min(v / this.C, 0.99999999);
        const gamma = 1 / Math.sqrt(1 - Math.pow(beta, 2));
        // Précision numérique inversement proportionnelle à la vitesse
        const prec = Math.round(Math.max(8, 32 - Math.log10(v + 1) * 4));
        return { res, gamma, prec };
    },

    // 2. LOGIQUE TEMPORELLE AUTONOME (HORS LIGNE)
    updateTime(gamma) {
        const now = performance.now();
        const dt_sec = (now - this.state.lastTick) / 1000;
        this.state.lastTick = now;

        // Mise à jour Temps Éphéméride (Temps absolu coordonné)
        this.state.jd += (dt_sec / 86400);
        // Mise à jour Temps Propre (Temps vécu dans le vaisseau/objet)
        this.state.tau += (dt_sec / gamma);
    },

    processPhysics(e) {
        if (!this.state.active) return;
        const a = e.acceleration;
        if (!a.x) return;

        const dt = 1/60; // Pas d'échantillonnage
        const accMag = Math.sqrt(a.x**2 + a.y**2 + a.z**2);
        
        // Mise à jour vitesse
        this.state.v += accMag * dt;

        // Mise à jour position 3D (Zéro dérive grâce à la précision BigNumber)
        const scale = this.getScale(this.state.v);
        math.config({ precision: scale.prec });
        
        this.state.pos.x = math.add(this.state.pos.x, math.multiply(math.bignumber(this.state.v), math.bignumber(dt)));
    },

    // 3. ÉPHÉMÉRIDES ET RÉFRACTION (Utilise ephem.js)
    getCelestial(jd) {
        // Simulation des calculs VSOP2013 / ELP2000
        // (En production, ces fonctions sont appelées depuis ephem.js)
        const sunAlt = 15.4; // Exemple de valeur retournée
        
        // Correction de réfraction atmosphérique proportionnelle
        const refr = (sunAlt > 0) ? (1.02 / Math.tan((sunAlt + 10.3 / (sunAlt + 5.11)) * Math.PI / 180)) / 60 : 0;
        
        return { sun: sunAlt + refr };
    },

    run() {
        if (!this.state.active) return;
        
        const scale = this.getScale(this.state.v);
        this.updateTime(scale.gamma);
        const cel = this.getCelestial(this.state.jd);

        // MISE À JOUR HUD VISUELLE
        document.getElementById('ui-jd').innerText = this.state.jd.toFixed(8);
        document.getElementById('ui-gamma').innerText = scale.gamma.toFixed(10);
        document.getElementById('ui-tau').innerText = this.state.tau.toFixed(3) + "s";
        document.getElementById('ui-res').innerText = scale.res.toFixed(4) + "m";
        document.getElementById('ui-prec').innerText = scale.prec + " digits";
        document.getElementById('ui-sun').innerText = cel.sun.toFixed(4) + "°";
        
        // Gestion Unités de Vitesse (Relativiste vs Classique)
        const speedHUD = document.getElementById('ui-speed-val');
        const unitHUD = document.getElementById('ui-speed-unit');
        
        if (this.state.v > (this.C * 0.01)) {
            speedHUD.innerText = (this.state.v / this.C).toFixed(6);
            unitHUD.innerText = "FRACTION_C (LIGHT_SPEED)";
        } else {
            speedHUD.innerText = this.state.v.toFixed(2);
            unitHUD.innerText = "METERS / SEC";
        }

        // Affichage Position Haute Précision
        document.getElementById('ui-pos-x').innerText = "X: " + math.format(this.state.pos.x, {notation: 'fixed', precision: 18});

        requestAnimationFrame(() => this.run());
    },

    log(msg) {
        const consoleObj = document.getElementById('console-log');
        consoleObj.innerHTML = "> " + msg + "<br>" + consoleObj.innerHTML;
    }
};
</script>

</body>
    </html>
