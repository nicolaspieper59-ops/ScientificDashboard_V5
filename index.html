<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>PROVIDENCE V17-ULTIMA ‚Ä¢ SEXTANT & 128-BIT</title>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/11.8.0/math.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;900&family=JetBrains+Mono:wght@300;500;800&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --bg: #010101; --panel: rgba(12, 12, 15, 0.98); --border: #1f1f25;
            --accent: #00ff88; --blue: #00c3ff; --gold: #ffd700; --critical: #ff3300;
        }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { 
            background: var(--bg); color: #e0e0e0; font-family: 'JetBrains Mono', monospace; 
            height: 100vh; width: 100vw; overflow: hidden; display: flex; flex-direction: column; font-size: 9px;
        }

        /* HEADER FIX */
        header { height: 60px; border-bottom: 1px solid var(--border); display: grid; grid-template-columns: 1fr 1.5fr 1fr; align-items: center; padding: 0 15px; background: #000; flex-shrink: 0; }

        /* MAIN LAYOUT FIX (Anti-vide et Anti-d√©bordement) */
        main { 
            flex: 1; display: grid; grid-template-columns: 290px 1fr 290px; gap: 6px; padding: 6px; 
            overflow: hidden; /* Emp√™che le body de scroller */
        }
        .column { 
            display: flex; flex-direction: column; gap: 6px; height: 100%; 
            overflow-y: auto; scrollbar-width: none; /* Scroll interne propre */
        }
        .column::-webkit-scrollbar { display: none; }

        .panel { 
            background: var(--panel); border: 1px solid var(--border); padding: 8px; border-radius: 4px;
            display: flex; flex-direction: column;
        }
        .fill-space { flex-grow: 1; } /* Comble le vide central */

        h2 { font-family: 'Orbitron'; font-size: 0.65rem; color: var(--blue); border-bottom: 1px solid #222; margin-bottom: 6px; padding-bottom: 4px; text-transform: uppercase; }
        
        .data-point { display: flex; justify-content: space-between; padding: 2px 0; border-bottom: 1px solid #111; }
        .data-point span:first-child { color: #666; font-size: 0.8em; }
        .data-point span:last-child { color: #fff; font-weight: bold; }
        
        /* MODULE SEXTANT VISUEL */
        #sextant-viewport {
            height: 120px; background: radial-gradient(circle at center, #001 0%, #000 100%);
            border: 1px solid #333; position: relative; overflow: hidden; margin: 5px 0;
        }
        .horizon-line { position: absolute; width: 100%; height: 1px; background: var(--blue); top: 50%; opacity: 0.5; }
        .celestial-body { position: absolute; width: 10px; height: 10px; border-radius: 50%; background: #fff; box-shadow: 0 0 10px #fff; left: 50%; margin-left: -5px; }

        .big-speed { font-family: 'Orbitron'; font-size: 2.2rem; color: var(--accent); text-align: center; }
        .btn-init { background: var(--accent); color: #000; border: none; font-family: 'Orbitron'; font-weight: 900; padding: 10px; width: 100%; cursor: pointer; margin-top: auto; }
        #anomaly-log { height: 70px; background: #000; font-size: 0.6rem; padding: 5px; color: var(--gold); border: 1px solid #222; overflow-y: auto; margin-top: 5px; }
    </style>
</head>
<body>

<header>
    <div>
        <div style="font-family:'Orbitron'; font-weight:900; color:var(--accent); font-size: 1.2rem;">PROVIDENCE V17-ULTIMA</div>
        <div id="reality-status-main" style="color:var(--gold); font-size:0.6rem;">MISSION_READY (128-BIT)</div>
    </div>
    <div style="text-align: center;">
        <div id="main-speed" class="big-speed">--.------</div>
        <div style="font-size:0.5rem; letter-spacing: 2px;">VITESSE_STABLE_V17 (M/S)</div>
    </div>
    <div style="text-align:right;">
        <div id="utc-datetime" style="color:var(--blue);">--/--/-- --:--:--</div>
        <div style="font-size:0.55rem;">TSLV: <span id="tslv">--</span> | JD: <span id="ast-jd">--</span></div>
        <div id="status-thermal-main" style="color:var(--accent);">CPU_THERMAL: OK</div>
    </div>
</header>

<main>
    <div class="column">
        <section class="panel">
            <h2><i class="fas fa-compass"></i> NAVIGATION_ASTRONOMIQUE</h2>
            <div id="sextant-viewport">
                <div class="horizon-line"></div>
                <div id="v-celestial" class="celestial-body" style="top: 30%;"></div>
            </div>
            <div class="data-point"><span>Angle Sextant (Brut)</span><span id="sextant-angle">--¬∞</span></div>
            <div class="data-point"><span>R√©fraction Atm.</span><span id="refraction-corr">--'</span></div>
            <div class="data-point"><span>√âl√©vation Corrig√©e</span><span id="sun-el-corr">--¬∞</span></div>
            <div class="data-point"><span>Midi Solaire Local</span><span id="noon-solar">--</span></div>
        </section>

        <section class="panel">
            <h2><i class="fas fa-atom"></i> RELATIVIT√â_G√âN√âRALE</h2>
            <div class="data-point"><span>Facteur Lorentz (Œ≥)</span><span id="ui-gamma">--</span></div>
            <div class="data-point"><span>Dilatation (RR)</span><span id="time-dilation">--</span></div>
            <div class="data-point"><span>Dilation Grav (RG)</span><span id="time-dilation-gravite">--</span></div>
            <div class="data-point"><span>Potentiel Œ¶ / Rs</span><span><span id="ui-grav-phi">--</span> / <span id="schwarzschild-radius">--</span></span></div>
            <div class="data-point"><span>√ânergie Relativiste</span><span id="relativistic-energy">--</span></div>
        </section>

        <section class="panel">
            <h2><i class="fas fa-satellite"></i> COORDONN√âES_ECEF</h2>
            <div id="map" style="height: 100px; border: 1px solid #222;"></div>
            <div class="data-point"><span>X / Y / Z</span><span><span id="coord-x">--</span>, <span id="coord-y">--</span>, <span id="coord-z">--</span></span></div>
            <div class="data-point"><span>Pr√©cision Horiz.</span><span id="ui-gps-accuracy">-- m</span></div>
        </section>
    </div>

    <div class="column">
        <section class="panel fill-space">
            <h2><i class="fas fa-tachometer-alt"></i> ANALYSE_DYNAMIQUE_AVANC√âE</h2>
            <div class="data-point"><span>Vitesse Stable (km/h)</span><span id="speed-stable-kmh" style="font-size:1.2em; color:var(--accent);">--</span></div>
            <div class="data-point"><span>Vitesse Stable (m/s)</span><span id="speed-stable-ms">--</span></div>
            <div class="data-point"><span>Vitesse Max Session</span><span id="speed-max-session">--</span></div>
            <div class="data-point"><span>Nombre de Mach</span><span id="mach-number">--</span></div>
            <div class="data-point"><span>% Vitesse Lumi√®re</span><span id="pct-speed-of-light">-- %</span></div>
            <div class="data-point"><span>Vitesse du Son Cor.</span><span id="vitesse-son-cor">--</span></div>
            <div class="data-point"><span>Vitesse Verticale (Vz)</span><span id="vel-z">--</span></div>
            <div class="data-point"><span>Jerk (Vibration)</span><span id="jerk-vector">--</span></div>
            <div class="data-point"><span>Mode Actif</span><span id="nav-mode">SURFACE</span></div>
            
            <div style="margin-top:auto; padding-top:10px;">
                <div class="data-point"><span>Confiance EKF_21</span><span id="kalman-p-certainty">--%</span></div>
                <div id="anomaly-log">> INITIALIZING_OMNI_KERNEL...</div>
                <button id="start-btn-final" class="btn-init" onclick="CORE.init()">üöÄ D√âMARRER LA MISSION</button>
            </div>
        </section>
    </div>

    <div class="column">
        <section class="panel">
            <h2><i class="fas fa-cloud-sun"></i> BIOSVT_ATMOSPH√àRE</h2>
            <div class="data-point"><span>Pression (hPa)</span><span id="ui-pressure">--</span></div>
            <div class="data-point"><span>Densit√© Air (œÅ)</span><span id="ui-rho-dynamic">--</span></div>
            <div class="data-point"><span>Temp Air / Ros√©e</span><span><span id="air-temp-c">--</span> / <span id="dew-point">--</span></span></div>
            <div class="data-point"><span>Indice CAPE</span><span id="CAPE">--</span></div>
            <div class="data-point"><span>Humidit√© Rel.</span><span id="humidity-perc">-- %</span></div>
            <div class="data-point"><span>Saturation O‚ÇÇ</span><span id="O2-saturation">-- %</span></div>
        </section>

        <section class="panel">
            <h2><i class="fas fa-wind"></i> M√âCANIQUE_DES_FLUIDES</h2>
            <div class="data-point"><span>Force de Tra√Æn√©e</span><span id="ui-drag-force">-- N</span></div>
            <div class="data-point"><span>Nb. Reynolds (Re)</span><span id="reynolds-number">--</span></div>
            <div class="data-point"><span>Puissance (Watts)</span><span id="human-power-w">-- W</span></div>
            <div class="data-point"><span>Force Coriolis</span><span id="coriolis-force">-- N</span></div>
            <div class="data-point"><span>Pouss√©e Archim√®de</span><span id="ui-f-arch">-- N</span></div>
        </section>

        <section class="panel">
            <h2><i class="fas fa-biohazard"></i> SIGNATURE_BIO_LOGS</h2>
            <div class="data-point"><span>Adr√©naline Index</span><span id="adrenaline-idx">--</span></div>
            <div class="data-point"><span>Fluidit√© Score</span><span id="smoothness-score">--/100</span></div>
            <div class="data-point"><span>Type de Mouvement</span><span id="bio-signature-type">STATIONNAIRE</span></div>
            <div style="height:40px; display:flex; justify-content:center; align-items:center; border: 1px solid #222; margin: 5px 0;">
                <div id="spirit-level" style="width:30px; height:30px; border:1px solid #444; border-radius:50%; position:relative;">
                    <div id="imu-bubble" style="width:6px; height:6px; background:var(--accent); border-radius:50%; position:absolute; top:50%; left:50%; transform:translate(-50%,-50%);"></div>
                </div>
            </div>
            <div class="data-point"><span>Pitch / Roll</span><span><span id="pitch">--</span>¬∞ / <span id="roll">--</span>¬∞</span></div>
        </section>
    </div>
</main>

<script>
/**
 * PROVIDENCE CORE V17 ‚Ä¢ SEXTANT & PHYSICS ENGINE
 */
math.config({ number: 'BigNumber', precision: 128 });
const _B = (n) => math.bignumber(n);

const CORE = {
    active: false,
    t0: performance.now(),

    init() {
        this.active = true;
        document.getElementById('start-btn-final').style.display = 'none';
        document.getElementById('reality-status-main').innerText = "MISSION_ACTIVE (128-BIT)";
        this.log("MOTEUR_V17_STABLE_OK");
        this.startPrecisionClock();
    },

    // Calcul de la r√©fraction astronomique (Sextant)
    // R = 1 / tan(h + 7.31 / (h + 4.4)) en minutes d'arc
    calculateRefraction(h) {
        if (h <= 0) return _B(0);
        const h_deg = parseFloat(h);
        const refrac = 1.0 / Math.tan((h_deg + 7.31 / (h_deg + 4.4)) * Math.PI / 180.0);
        return _B(refrac);
    },

    updateSextantUI(el_angle) {
        const refrac = this.calculateRefraction(el_angle);
        document.getElementById('sextant-angle').innerText = el_angle.toFixed(2) + "¬∞";
        document.getElementById('refraction-corr').innerText = refrac.toFixed(2) + "'";
        document.getElementById('sun-el-corr').innerText = (el_angle - (refrac/60)).toFixed(3) + "¬∞";
        
        // Mise √† jour visuelle du sextant
        const body = document.getElementById('v-celestial');
        const pos = 100 - ((el_angle / 90) * 100);
        body.style.top = pos + "%";
    },

    startPrecisionClock() {
        setInterval(() => {
            const d = new Date();
            document.getElementById('utc-datetime').innerText = d.toISOString().replace('T',' ').substring(0,19);
        }, 1000);
    },

    log(m) {
        const el = document.getElementById('anomaly-log');
        el.innerHTML = `<div>[${new Date().toLocaleTimeString()}] > ${m}</div>` + el.innerHTML;
    }
};

// Init Map
const map = L.map('map', {zoomControl: false}).setView([0,0], 2);
L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png').addTo(map);

</script>
</body>
    </html>
