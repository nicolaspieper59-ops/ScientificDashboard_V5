<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>PROVIDENCE V140 • OMNI-SOUVERAIN ULTRA-CORE</title>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/11.8.0/math.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/0.158.0/three.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=JetBrains+Mono:wght@300;500;800&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --bg: #020202; --panel-bg: rgba(10, 10, 12, 0.98); --border: #1a1a1f;
            --accent: #00ff88; --blue: #00c3ff; --gold: #ffd700; --critical: #ff3300; --violet: #bc13fe;
        }
        * { box-sizing: border-box; margin: 0; padding: 0; user-select: none; }
        body { background: var(--bg); color: #e0e0e0; font-family: 'JetBrains Mono', monospace; height: 100dvh; width: 100vw; overflow: hidden; display: flex; flex-direction: column; font-size: 8.5px; }
        header { height: 40px; border-bottom: 1px solid #333; display: flex; align-items: center; justify-content: space-between; padding: 0 12px; background: #000; z-index: 100; }
        main { flex: 1; display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 6px; padding: 6px; overflow-y: auto; background: radial-gradient(circle at 50% 50%, #08080c 0%, #000 100%); }
        .panel { background: var(--panel-bg); border: 1px solid var(--border); border-radius: 2px; display: flex; flex-direction: column; border-top: 2px solid var(--border); margin-bottom: 4px; }
        .panel-header { padding: 4px 10px; background: rgba(255, 255, 255, 0.02); border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; }
        .panel-header h2 { font-family: 'Orbitron'; font-size: 0.6rem; letter-spacing: 1px; margin: 0; text-transform: uppercase; }
        .metrics-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 3px; margin-bottom: 4px; }
        .data-box { background: rgba(0,0,0,0.5); border: 1px solid #1a1a1a; padding: 4px 6px; display: flex; flex-direction: column; border-left: 2px solid #333; }
        .label { font-size: 0.45rem; color: #555; text-transform: uppercase; margin-bottom: 1px; }
        .value { font-size: 0.75rem; color: #fff; font-weight: 500; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .unit { font-size: 0.45rem; color: #444; margin-left: 2px; }
        footer { background: #000; border-top: 1px solid #333; display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 6px; padding: 6px; }
        #map { height: 110px; width: 100%; border: 1px solid #222; margin-bottom: 4px; }
        canvas { width: 100%; background: #000; }
        button { background: #111; color: #888; border: 1px solid #333; padding: 5px; font-family: 'Orbitron'; font-size: 0.55rem; cursor: pointer; }
        .btn-main { background: var(--accent); color: #000; border: none; font-weight: 800; width: 100%; height: 30px; }
        #anomaly-log { font-size: 0.6rem; color: var(--accent); height: 70px; overflow-y: auto; background: #050505; padding: 4px; border: 1px solid #111; font-family: 'JetBrains Mono'; }
        progress { width: 100%; height: 3px; appearance: none; border: none; background: #111; }
        progress::-webkit-progress-value { background: var(--accent); }
    </style>
</head>
<body>

<header>
    <div style="font-family:'Orbitron'; color:var(--accent);">PROVIDENCE <span id="ui-version">V140.0-ULTRA</span></div>
    <div style="font-family:'Orbitron'; font-size:1rem; color:var(--blue);" id="ui-clock">00:00:00</div>
    <div style="font-size:0.55rem; color:#666;">
        SMP: <span id="ui-sampling-rate">--</span>Hz | LAT: <span id="tslv">0ms</span> | UP: <span id="ui-uptime">00:00:00</span>
    </div>
</header>

<main>
    <section class="panel" style="border-top-color: var(--blue);">
        <div class="panel-header"><h2 style="color:var(--blue);">NAV_CORE_EKF</h2><span id="ui-env-mode">INITIALIZING</span></div>
        <div class="panel-content">
            <div id="map"></div>
            <div class="metrics-grid">
                <div class="data-box" style="border-left-color:var(--blue);"><span class="label">Lat EKF</span><span class="value" id="lat-ekf">0.000000</span></div>
                <div class="data-box" style="border-left-color:var(--blue);"><span class="label">Lon EKF</span><span class="value" id="lon-ekf">0.000000</span></div>
                <div class="data-box"><span class="label">Altitude</span><span class="value"><span id="alt-ekf">0.00</span><span class="unit">m</span></span></div>
                <div class="data-box"><span class="label">Alt Ellipsoid</span><span class="value" id="alt-ellipsoid">0.00</span></div>
                <div class="data-box"><span class="label">Prec GPS</span><span class="value">±<span id="acc-gps">0.0</span><span class="unit">m</span></span></div>
                <div class="data-box"><span class="label">V-Prec</span><span class="value" id="ui-v-accuracy">0.0</span></div>
                <div class="data-box"><span class="label">Heading</span><span class="value" id="heading-display">000.0°</span></div>
                <div class="data-box"><span class="label">True North</span><span class="value" id="ui-true-north">000.0°</span></div>
                <div class="data-box"><span class="label">Ground Speed</span><span class="value" id="ui-ground-speed">0.00</span></div>
                <div class="data-box"><span class="label">Declinaison</span><span class="value" id="ui-mag-declination">0.0°</span></div>
                <div class="data-box"><span class="label">Sats Count</span><span class="value" id="ui-sat-count">0</span></div>
                <div class="data-box"><span class="label">HDOP</span><span class="value" id="ui-gps-hdop">0.00</span></div>
                <div class="data-box"><span class="label">VDOP</span><span class="value" id="ui-gps-vdop">0.00</span></div>
                <div class="data-box"><span class="label">PDOP</span><span class="value" id="ui-gps-pdop">0.00</span></div>
            </div>
            <div class="metrics-grid">
                <div class="data-box" style="border-left-color:var(--gold);"><span class="label">Dist. Home</span><span class="value" id="ui-home-dist">0.00 m</span></div>
                <div class="data-box"><span class="label">Bearing Home</span><span class="value" id="ui-bearing-home">000°</span></div>
                <div class="data-box"><span class="label">Schuler Status</span><span class="value" id="ui-schuler-status">LOCKED</span></div>
                <div class="data-box"><span class="label">Kalman Gain</span><span class="value" id="ui-kalman-gain">0.00</span></div>
            </div>
        </div>
    </section>

    <section class="panel" style="border-top-color: var(--accent);">
        <div class="panel-header"><h2 style="color:var(--accent);">KINETIC_DYNAMICS</h2><span id="ui-scale-active">NANO_RES</span></div>
        <div class="panel-content">
            <canvas id="gforce-canvas" height="60"></canvas>
            <div class="data-box" style="margin: 4px 0; border: 1px solid var(--accent); text-align:center;">
                <span class="label">Vitesse Brute Absolute (mm/s)</span>
                <span class="value" id="vitesse-raw" style="font-size:1.3rem; color:var(--accent);">0.000000000</span>
            </div>
            <div class="metrics-grid">
                <div class="data-box"><span class="label">KM/H</span><span class="value" id="speed-stable-kmh">0.00</span></div>
                <div class="data-box"><span class="label">Knots</span><span class="value" id="ui-speed-knots">0.00</span></div>
                <div class="data-box"><span class="label">Mach Num</span><span class="value" id="mach-val">0.000</span></div>
                <div class="data-box" style="border-left-color:var(--violet);"><span class="label">Lorentz γ</span><span class="value" id="ui-lorentz">1.000000</span></div>
                <div class="data-box"><span class="label">Acc X</span><span class="value" id="acc-x">0.00</span></div>
                <div class="data-box"><span class="label">Acc Y</span><span class="value" id="acc-y">0.00</span></div>
                <div class="data-box"><span class="label">Acc Z</span><span class="value" id="acc-z">0.00</span></div>
                <div class="data-box"><span class="label">Jerk</span><span class="value" id="ui-jerk">0.00</span></div>
                <div class="data-box"><span class="label">G-Force Inst</span><span class="value" id="force-g-inst">1.00 G</span></div>
                <div class="data-box" style="border-left-color:var(--critical);"><span class="label">Impact Max</span><span class="value" id="ui-impact-g">0.00 G</span></div>
            </div>
            <div class="metrics-grid">
                <div class="data-box"><span class="label">Sport Cadence</span><span class="value" id="ui-sport-cadence">0</span></div>
                <div class="data-box"><span class="label">Jump Height</span><span class="value" id="ui-jump-height">0.0 cm</span></div>
                <div class="data-box"><span class="label">Activity</span><span class="value" id="ui-sport-type">STATIC</span></div>
                <div class="data-box"><span class="label">Metabolic Cal</span><span class="value" id="ui-calories">0</span></div>
            </div>
        </div>
    </section>

    <section class="panel" style="border-top-color: var(--gold);">
        <div class="panel-header"><h2 style="color:var(--gold);">ENVIRONMENT_FLUIDS</h2><span id="ui-rad-total">0 mSv</span></div>
        <div class="panel-content">
            <div class="metrics-grid">
                <div class="data-box"><span class="label">Température</span><span class="value"><span id="air-temp-c">20.0</span>°C</span></div>
                <div class="data-box"><span class="label">Humidité</span><span class="value" id="humidity-pct">45%</span></div>
                <div class="data-box"><span class="label">Pression HPA</span><span class="value" id="pressure-hpa">1013</span></div>
                <div class="data-box"><span class="label">Luxmètre</span><span class="value" id="ambient-light">0 lx</span></div>
                <div class="data-box"><span class="label">Rad Level</span><span class="value" id="ui-rad-level">0.080</span></div>
                <div class="data-box"><span class="label">Mag Flux µT</span><span class="value" id="ui-elec-flux">0.00</span></div>
                <div class="data-box"><span class="label">Induction W</span><span class="value" id="ui-elec-watt">0.00</span></div>
                <div class="data-box"><span class="label">Air PM2.5</span><span class="value" id="pm25-val">0.0</span></div>
            </div>
            <div class="data-box" style="background:rgba(255,215,0,0.03); margin-bottom:4px;">
                <span class="label">Nombre de Reynolds (Re)</span>
                <span class="value" id="reynolds-number">0</span>
                <div style="font-size:0.4rem; color:var(--gold);">Mode: <span id="ui-flow-regime">LAM</span></div>
            </div>
            <div class="metrics-grid">
                <div class="data-box"><span class="label">Pression Dyn</span><span class="value" id="dynamic-pressure">0 Pa</span></div>
                <div class="data-box"><span class="label">Densité ρ</span><span class="value" id="air-density">1.225</span></div>
                <div class="data-box"><span class="label">Speed Sound</span><span class="value" id="ui-speed-sound">343 m/s</span></div>
                <div class="data-box"><span class="label">Dew Point</span><span class="value" id="ui-dew-point">0.0°C</span></div>
            </div>
        </div>
    </section>
</main>

<footer>
    <div class="panel" style="border-left: 3px solid var(--violet);">
        <div class="panel-content">
            <div class="metrics-grid">
                <div class="data-box"><span class="label">Julian Date</span><span class="value" id="ast-jd">--</span></div>
                <div class="data-box"><span class="label">MJD</span><span class="value" id="ast-mjd">--</span></div>
                <div class="data-box"><span class="label">Sidereal</span><span class="value" id="ui-sidereal">--</span></div>
                <div class="data-box"><span class="label">MC Ticks</span><span class="value" id="time-minecraft">--</span></div>
                <div class="data-box"><span class="label">Moon Phase</span><span class="value" id="moon-phase-name">--</span></div>
                <div class="data-box"><span class="label">Δ-Time Dil</span><span class="value" id="total-time-dilation" style="color:var(--violet);">0 ns</span></div>
            </div>
            <div class="data-box" style="margin-top:2px;">
                <span class="label">Cosmos Distance (LY)</span>
                <span class="value" id="ui-dist-ly" style="font-size:0.6rem;">0.0000000000</span>
                <div style="display:flex; justify-content:space-between; font-size:0.4rem; color:#444;">
                    <span>Comobile: <span id="ui-dist-comobile">0</span>m</span>
                    <span>Horizon: <span id="ui-observable-pct">0</span>%</span>
                </div>
            </div>
        </div>
    </div>

    <div class="panel" style="border-left: 3px solid #6600cc;">
        <div class="panel-content">
            <div class="label" style="display:flex; justify-content:space-between;">IA CONFIDENCE <span id="trust-imu-val">0%</span></div>
            <progress id="trust-imu" value="100" max="100"></progress>
            <progress id="trust-opt" value="0" max="100" style="margin-top:2px;"></progress>
            <progress id="trust-audio" value="0" max="100" style="margin-top:2px;"></progress>
            <div class="data-box" style="margin-top:4px;"><span class="label">Master Source</span><span class="value" id="master-source">IDLE</span></div>
            <div style="height:35px; background:#000; border:1px solid #111; margin-top:4px; position:relative;">
                <canvas id="ar-canvas" height="35"></canvas>
                <div id="ui-path-points" style="position:absolute; bottom:2px; right:4px; font-size:0.4rem; color:#444;">0 PTS</div>
            </div>
        </div>
    </div>

    <div class="panel">
        <div class="panel-content">
            <div id="anomaly-log">> SYSTEM_STANDBY...</div>
            <button id="main-init-btn" class="btn-main" style="margin-top:4px;">INITIALISER_OMNI_V140</button>
            <div style="display:grid; grid-template-columns: 1fr 1fr 1fr 1fr; gap:2px; margin-top:3px;">
                <button onclick="OMNI_CORE.setAnchor()">ZERO</button>
                <button id="export-metrics-btn">CSV</button>
                <button id="clear-log-btn" onclick="document.getElementById('anomaly-log').innerHTML=''">CLS</button>
                <button id="emergency-stop-btn" style="color:var(--critical);">HALT</button>
            </div>
        </div>
    </div>
</footer>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/11.8.0/math.js"></script>
<script>
let wakeLock = null;

async function startAdventure() {
    if ('wakeLock' in navigator) {
        try {
            wakeLock = await navigator.wakeLock.request('screen');
            document.getElementById('reality-status-main').innerText = "WAKE_LOCK_ACTIVE";
            document.getElementById('reality-status-main').style.color = "var(--accent)";
        } catch (err) { console.log("WakeLock Error"); }
    }
    
    if(typeof initCore === "function") {
        initCore();
    }
}

document.addEventListener('visibilitychange', async () => {
    if (wakeLock !== null && document.visibilityState === 'visible') {
        wakeLock = await navigator.wakeLock.request('screen');
    }
});
</script>         
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/11.8.0/math.js"></script>
<script src="vendor/three.min.js"></script>
<script src="vendor/turf.min.js"></script>
<script src="vendor/leaflet.js"></script>    

<script src="lib/ephem.js"></script>
<script src="lib/astro.js"></script>    
    
<script src="gnss-dashboard-full.js"></script>                  
</body>
</html>
