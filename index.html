<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>OMNISCIENCE V17 PRO MAX • TOTAL_RECALL_CORE</title>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/11.8.0/math.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/0.158.0/three.min.js"></script>
    <style>
:root {
    --bg: #000000;
    --hud-color: #00ff88;
    --alert-color: #ff3300;
    --glass: rgba(0, 20, 10, 0.6);
}

body, html {
    margin: 0; padding: 0;
    width: 100%; height: 100%;
    overflow: hidden;
    background: var(--bg);
    font-family: 'JetBrains Mono', monospace;
    color: var(--hud-color);
}

/* --- COUCHE 1 : VIDÉO (FOND) --- */
#ui-canvas {
    position: fixed;
    top: 0; left: 0;
    width: 100vw; height: 100vh;
    object-fit: cover;
    z-index: 0; /* Au fond */
}

/* --- COUCHE 2 : VISUALISATION 3D (MILIEU) --- */
.v-main-container {
    position: fixed;
    top: 50%; left: 0;
    transform: translateY(-50%);
    width: 100%; height: 300px;
    z-index: 10;
    pointer-events: none; /* Laisse passer les clics */
}

/* --- COUCHE 3 : AR HUD (HORIZON) --- */
#camera-hud {
    position: fixed;
    top: 0; left: 0;
    width: 100vw; height: 100vh;
    z-index: 15;
    pointer-events: none;
}

/* --- COUCHE 4 : UI TEXTE (DEVANT) --- */
.hud-panel {
    position: fixed;
    padding: 15px;
    background: var(--glass);
    border: 1px solid var(--hud-color);
    backdrop-filter: blur(4px);
    z-index: 20;
    border-radius: 8px;
    box-shadow: 0 0 10px rgba(0, 255, 136, 0.2);
}

/* Positionnement des Panneaux */
#p-top-left { top: 10px; left: 10px; width: 200px; }
#p-top-right { top: 10px; right: 10px; width: 220px; text-align: right; }
#p-bottom { 
    bottom: 10px; left: 10px; right: 10px; 
    height: auto; 
    display: flex; 
    flex-wrap: wrap;
    justify-content: space-between;
    align-items: center;
}

/* Typographie & Données */
h2 {
    font-family: 'Orbitron', sans-serif;
    font-size: 0.9rem;
    margin: 0 0 10px 0;
    border-bottom: 1px solid var(--hud-color);
    padding-bottom: 5px;
    text-transform: uppercase;
}

.data-row {
    display: flex;
    justify-content: space-between;
    margin-bottom: 4px;
    font-size: 0.8rem;
}

.val { font-weight: bold; color: #fff; }

/* Boutons de Contrôle */
.btn-ctrl {
    background: rgba(0, 0, 0, 0.8);
    border: 1px solid var(--hud-color);
    color: var(--hud-color);
    padding: 8px 12px;
    font-family: 'Orbitron', sans-serif;
    font-size: 0.7rem;
    cursor: pointer;
    text-transform: uppercase;
    pointer-events: auto; /* IMPORTANT: Rend les boutons cliquables */
    transition: all 0.2s;
    margin-right: 5px;
}

.btn-ctrl:hover { background: var(--hud-color); color: #000; }
.btn-ctrl.critical { border-color: var(--alert-color); color: var(--alert-color); }
.btn-ctrl.critical:hover { background: var(--alert-color); color: #fff; }

/* Bouton Topographie Flottant */
#topo-controls {
    pointer-events: auto;
}

/* Log d'anomalie */
#anomaly-log {
    width: 100%;
    height: 60px;
    overflow-y: auto;
    font-size: 0.65rem;
    color: #aaa;
    margin-top: 5px;
    border-top: 1px dotted #444;
}

/* Masquage Mobile pour éviter l'encombrement si nécessaire */
@media (max-width: 400px) {
    .v-main-container { opacity: 0.7; height: 200px; }
    h2 { font-size: 0.75rem; }
    .data-row { font-size: 0.7rem; }
}
    </style>
</head>
<body>

<video id="ui-canvas" autoplay playsinline muted></video>

<header>
    <div style="color: var(--accent); letter-spacing: 2px; font-family: 'Orbitron';">OMNISCIENCE_V17_PRO_MAX // <span id="ui-sampling-rate">100Hz</span></div>
    <div style="font-family: 'Orbitron'; font-size: 0.9rem; color: var(--blue);"><i class="far fa-clock"></i> <span id="ui-clock">00:00:00</span></div>
    <div style="font-size: 0.7rem; color: #666;">LATENCY: <span id="tslv">0ms</span></div>
</header>

<main>
    <div class="panel">
        <h2><i class="fas fa-layer-group"></i> Navigation_EKF_21</h2>
        <div id="map"></div>
        <div class="data-point"><span>Lat/Lon (EKF)</span><span><span id="lat-ekf">--</span> / <span id="lon-ekf">--</span></span></div>
        <div class="data-point"><span>Altitude (EKF)</span><span id="alt-ekf">--</span></div>
        <div class="data-point"><span>Vitesse Stable</span><span id="speed-stable-kmh">--</span></div>
        <div class="data-point"><span>Cap (Heading)</span><span id="heading-display">--</span></div>
        <div class="data-point"><span>Incertitude (P)</span><span id="ukf-v-uncert-2">--</span></div>
        
        <h3>Physique de Mission</h3>
        <div class="data-point"><span>Lorentz Factor (γ)</span><span id="ui-lorentz">1.00000000</span></div>
        <div class="data-point"><span>Force G Inst.</span><span id="force-g-inst">--</span></div>
        <div class="data-point"><span>Dilatation Temps</span><span id="total-time-dilation">--</span></div>
        <div class="data-point"><span>Gravité Théo.</span><span id="gravity-theoretical">--</span></div>
        <div class="data-point"><span>Pression Dyn (q)</span><span id="dynamic-pressure">--</span></div>
    </div>

    <div class="panel" style="border: 1px solid var(--accent); background: rgba(0,40,20,0.1);">
        <h2><i class="fas fa-microchip"></i> Visual_Core_Inertial</h2>
        <div class="v-main-container">
            <div id="val-speed" class="v-main">0.00</div>
            <div id="ui-speed-unit" style="text-align:center; letter-spacing:10px; color: var(--accent); font-size: 0.8rem;">METERS / SEC</div>
        </div>
        
        <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px; margin-top: 10px;">
            <div>
                <h3>Position SLAM (mm)</h3>
                <div class="data-point"><span>X-Rel</span><span id="pos-x">0.0000</span></div>
                <div class="data-point"><span>Y-Alt</span><span id="pos-y">0.0000</span></div>
                <div class="data-point"><span>Z-Rel</span><span id="pos-z">0.0000</span></div>
            </div>
            <div>
                <h3>Odométrie 3D</h3>
                <div class="data-point"><span>Distance</span><span id="distance-totale">--</span></div>
                <div class="data-point"><span>V-Cosmic</span><span id="v-cosmic">--</span></div>
                <div class="data-point"><span>Stress Str.</span><span id="structural-stress">--</span></div>
            </div>
        </div>
        <div id="anomaly-log">> AWAITING_BOOT_SEQUENCE...</div>
        <button id="main-init-btn" class="btn-init" onclick="startAdventure()">Initialiser le Coeur</button>
    </div>

    <div class="panel">
        <h2><i class="fas fa-wind"></i> Environment_Sensors</h2>
        <div class="data-point"><span>Temp. Air (°C)</span><span id="air-temp-c">--</span></div>
        <div class="data-point"><span>Pression (hPa)</span><span id="pressure-hpa">--</span></div>
        <div class="data-point"><span>Densité Air (ρ)</span><span id="air-density">--</span></div>
        <div class="data-point"><span>Humidité (%)</span><span id="humidity-pct">--</span></div>
        <div class="data-point"><span>Point de Rosée</span><span id="dew-point">--</span></div>
        
        <h3>Atmosphère & Bio-Scan</h3>
        <div class="data-point"><span>PM2.5 / PM10</span><span><span id="pm25-val">--</span> / <span id="pm10-val">--</span></span></div>
        <div class="data-point"><span>NO2 / Ozone</span><span><span id="no2-val">--</span> / <span id="o3-val">--</span></span></div>
        <div class="data-point"><span>Saturation O2</span><span id="O2-saturation">--</span></div>
        <div class="data-point"><span>Photosynthèse</span><span id="photosynthesis-rate">--</span></div>
        <div class="data-point"><span>CAPE Index</span><span id="CAPE">--</span></div>
        <div class="data-point"><span>Lumière (Lux)</span><span id="ambient-light">--</span></div>
    </div>
</main>

<footer>
    <div class="panel">
        <h2><i class="fas fa-hourglass-start"></i> Temporal_Sync</h2>
        <div class="data-point"><span>Julian Date</span><span id="ast-jd">--</span></div>
        <div class="data-point"><span>Temps Propre (τ)</span><span id="val-tau">--</span></div>
        <div class="data-point"><span>Delta T (ΔT)</span><span id="ast-deltat">--</span></div>
        <div class="data-point"><span>Equation Time</span><span id="equation-time">--</span></div>
    </div>
    
    <div class="panel">
        <h2><i class="fas fa-sun"></i> Heliocentric</h2>
        <div class="data-point"><span>Soleil (Az/Alt)</span><span><span id="sun-azimuth">--</span> / <span id="sun-alt">--</span></span></div>
        <div class="data-point"><span>Lever / Coucher</span><span><span id="sunrise-times">--</span> / <span id="sunset-times">--</span></span></div>
        <div class="data-point"><span>Durée Jour</span><span id="day-duration">--</span></div>
        <div class="data-point"><span>Horizon Dist.</span><span id="distance-horizon">--</span></div>
    </div>
    
    <div class="panel">
        <h2><i class="fas fa-moon"></i> Selenocentric</h2>
        <div class="data-point"><span>Phase / Illum.</span><span><span id="moon-phase-name">--</span> / <span id="moon-illuminated">--</span></span></div>
        <div class="data-point"><span>Lune (Az/Alt)</span><span><span id="moon-azimuth">--</span> / <span id="moon-alt">--</span></span></div>
        <div class="data-point"><span>Distance Lune</span><span id="moon-distance">--</span></div>
        <div class="data-point"><span>Status Ephem</span><span id="ephem-status">READY</span></div>
    </div>
    
    <div class="panel">
        <h2><i class="fas fa-terminal"></i> Mission_Control</h2>
        <div class="data-point"><span>MATH_PRECISION</span><span>64 digits</span></div>
        <div class="data-point"><span>CORE_STATUS</span><span id="ui-res">ACTIVE</span></div>
        <div style="display:grid; grid-template-columns: 1fr 1fr; gap:6px; margin-top:5px;">
            <button id="toggle-gps-btn" class="btn-ctrl">GPS_TOGGLE</button>
            <button id="export-metrics-btn" class="btn-ctrl">CSV_EXPORT</button>
            <button id="emergency-stop-btn" class="btn-ctrl critical">EMG_STOP</button>
            <button id="clear-log-btn" class="btn-ctrl" onclick="document.getElementById('anomaly-log').innerHTML=''">CLEAR_LOG</button>
            <div id="topo-controls" style="position:fixed; bottom:200px; right:20px; z-index:100;">
    <button onclick="TOPO_SURVEY.addWaypoint('REPERE_GEOLOGIQUE')" 
            style="width:60px; height:60px; border-radius:50%; background:var(--gold); border:none; box-shadow: 0 0 15px var(--gold);">
        <i class="fas fa-map-marker-alt" style="color:#000; font-size:1.5rem;"></i>
    </button>
        </div>
    </div>
</footer>

<div id="scientific-hidden-buffer" style="display:none;">
    <span id="in-mass">80</span><span id="in-cx">0.4</span>
    <span id="mach-number"></span><span id="vertical-speed"></span>
    <span id="time-dilation-vitesse"></span><span id="time-dilation-gravite"></span>
</div>

<script src="gnss-dashboard-full.js"></script>                  

</body>
        </html>
