<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PROVIDENCE V17-ULTIMA | SOUVERAINETÉ_TOTALE</title>
    <style>
        :root {
            --bg: #000; --accent: #00ff88; --blue: #00c3ff; --warp: #7700ff; --gold: #ffd700; --panel: rgba(10,10,15,0.98);
        }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            background: var(--bg); color: #e0e0e0; font-family: 'JetBrains Mono', monospace;
            height: 100vh; overflow: hidden; display: flex; flex-direction: column;
            font-size: clamp(10px, 1vw, 13px);
        }
        header {
            padding: 10px 20px; border-bottom: 2px solid var(--accent);
            display: flex; justify-content: space-between; align-items: center;
            background: linear-gradient(180deg, #0a0a0a, #000);
        }
        .main-grid {
            display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 10px; padding: 10px; flex: 1; overflow-y: auto;
        }
        .panel {
            background: var(--panel); border: 1px solid #222; padding: 12px;
            border-radius: 4px; display: flex; flex-direction: column;
        }
        h2 { font-size: 0.7rem; color: var(--blue); border-bottom: 1px solid #333; margin-bottom: 8px; text-transform: uppercase; }
        .val { color: var(--accent); font-weight: bold; float: right; font-variant-numeric: tabular-nums; }
        #v-main { font-size: clamp(1.5rem, 4vw, 2.5rem); color: var(--accent); font-family: 'Orbitron'; }
        canvas { width: 100%; background: #050508; border-radius: 2px; margin-top: 5px; }
        .data-point { margin-bottom: 5px; border-bottom: 1px solid #111; padding-bottom: 2px; }
        #log-book { font-size: 0.55rem; color: #888; overflow-y: auto; height: 100px; border-left: 1px solid var(--warp); padding-left: 5px; }
        button { background: var(--accent); border: none; padding: 12px; font-weight: bold; cursor: pointer; margin-top: auto; border-radius: 4px; }
    </style>
</head>
<body>

<header>
    <div>
        <div style="font-weight:900; letter-spacing:2px;">PROVIDENCE V17-ULTIMA</div>
        <div style="font-size:0.5rem; color:var(--gold);">SOUVERAINETÉ_PHYSIQUE_FONDAMENTALE</div>
    </div>
    <div id="v-main">--.------</div>
    <div style="text-align: right;">
        <div id="ui-tau" style="color:var(--warp); font-size:1.1rem; font-weight:bold;">--:--:--.---</div>
        <div id="ui-hsv" style="color:var(--gold); font-size:0.7rem;">SOLAIRE: --:--:--</div>
    </div>
</header>

<main class="main-grid">
    <section class="panel">
        <h2><i class="fas fa-infinity"></i> ANALEMME_ET_SOLEIL</h2>
        <canvas id="analemma-cvs" height="100"></canvas>
        <div class="data-point" style="margin-top:8px;">Equation du Temps <span class="val" id="ui-eot">-- min</span></div>
        <div class="data-point">Midi Solaire <span class="val" id="ui-noon">--:--:--</span></div>
        <div id="terminator-status" style="text-align:center; font-size:0.6rem; margin-top:5px; font-weight:bold;">--</div>
    </section>

    <section class="panel">
        <h2><i class="fas fa-atom"></i> RELATIVITY_KERN</h2>
        <div class="data-point">Gamma ($\gamma$) <span class="val" id="ui-gamma">--</span></div>
        <div class="data-point">Décalage Cumulé <span class="val" id="ui-shift" style="color:var(--warp);">0.000 ns</span></div>
        <div class="data-point">Gravité Réelle ($g$) <span class="val" id="ui-g">--</span></div>
        <div class="data-point">Mach Number <span class="val" id="ui-mach">--</span></div>
    </section>

    <section class="panel">
        <h2><i class="fas fa-book"></i> MISSION_JOURNAL</h2>
        <div id="log-book"></div>
        <button onclick="KERNEL.init()">INITIALISER_MISSION_V17</button>
    </section>
</main>

<script>
const KERNEL = {
    state: { active: false, v: 0, h: 0, tau: 0, shift: 0, lat: 0, lon: 0, lastUpdate: performance.now(), lastMach: 0 },
    const: { c: 299792458, G: 6.6743e-11, M: 5.9722e24, R: 6378137 },

    init() {
        this.state.active = true;
        this.state.startTime = Date.now();
        this.setupSensors();
        this.addLog("MISSION_START", "COCKPIT_READY", "");
        this.loop();
    },

    setupSensors() {
        navigator.geolocation.watchPosition(p => {
            this.state.v = p.coords.speed || 0;
            this.state.h = p.coords.altitude || 0;
            this.state.lat = p.coords.latitude || 0;
            this.state.lon = p.coords.longitude || 0;
        }, null, { enableHighAccuracy: true });
    },

    addLog(type, val, unit) {
        const lb = document.getElementById('log-book');
        const time = new Date().toLocaleTimeString();
        lb.innerHTML = `<div style="margin-bottom:4px; border-bottom:1px solid #111;">
            <span style="color:var(--warp)">[${time}]</span> <span style="color:var(--gold)">${type}</span>: ${val}${unit}
        </div>` + lb.innerHTML;
    },

    getJulianDate(date) { return (date.getTime() / 86400000) + 2440587.5; },

    loop() {
        if (!this.state.active) return;
        const now = performance.now();
        const dt = (now - this.state.lastUpdate) / 1000;
        this.state.lastUpdate = now;

        const r = this.const.R + this.state.h;
        const v = this.state.v;
        const c = this.const.c;

        // 1. Dilatation Temps (Spéciale + Générale)
        const gravitationalTerm = (2 * this.const.G * this.const.M) / (r * c**2);
        const velocityTerm = (v**2) / (c**2);
        const timeFactor = Math.sqrt(1 - gravitationalTerm - velocityTerm);
        this.state.tau += dt * timeFactor;
        const currentShift = (dt - (dt * timeFactor)) * 1e9;
        this.state.shift += currentShift;

        // 2. Astronomie & Soleil
        const jd = this.getJulianDate(new Date());
        const d = jd - 2451545.0;
        const g = (357.529 + 0.98560028 * d) * Math.PI / 180;
        const q = (280.459 + 0.98564736 * d) * Math.PI / 180;
        const L = q + (1.915 * Math.sin(g) + 0.020 * Math.sin(2 * g)) * Math.PI / 180;
        const e = (23.439 - 0.00000036 * d) * Math.PI / 180;
        const RA = Math.atan2(Math.cos(e) * Math.sin(L), Math.cos(L)) * 180 / Math.PI;
        const eot = (q * 180 / Math.PI - RA) * 4; // Minutes
        
        const utc = new Date();
        const solarMin = (utc.getUTCHours()*60 + utc.getUTCMinutes() + utc.getUTCSeconds()/60) + eot + (this.state.lon * 4);

        // 3. Événements Log
        const mach = v / Math.sqrt(1.4 * 287 * 288.15);
        if(mach >= 1 && this.state.lastMach < 1) this.addLog("SUPERSO", mach.toFixed(2), "M");
        this.state.lastMach = mach;

        this.draw(timeFactor, eot, solarMin, mach, r);
        requestAnimationFrame(() => this.loop());
    },

    draw(timeFactor, eot, solarMin, mach, r) {
        document.getElementById('v-main').innerText = this.state.v.toFixed(6);
        document.getElementById('ui-gamma').innerText = (1/timeFactor).toFixed(14);
        document.getElementById('ui-shift').innerText = this.state.shift.toFixed(3) + " ns";
        document.getElementById('ui-g').innerText = ((this.const.G * this.const.M) / (r * r)).toFixed(6);
        document.getElementById('ui-mach').innerText = mach.toFixed(3);
        
        const d_tau = new Date(this.state.startTime + this.state.tau * 1000);
        document.getElementById('ui-tau').innerText = d_tau.toLocaleTimeString() + "." + d_tau.getMilliseconds().toString().padStart(3,'0');
        
        const h = Math.floor(solarMin/60)%24, m = Math.floor(solarMin%60), s = Math.floor((solarMin*60)%60);
        document.getElementById('ui-hsv').innerText = `SOLAIRE: ${h.toString().padStart(2,'0')}:${m.toString().padStart(2,'0')}:${s.toString().padStart(2,'0')}`;
        document.getElementById('ui-eot').innerText = eot.toFixed(2) + " min";
        
        const isDay = (solarMin > 360 && solarMin < 1080);
        const ts = document.getElementById('terminator-status');
        ts.innerText = isDay ? "MODE: JOUR_SOLAIRE" : "MODE: NUIT_ÉTOILÉE";
        ts.style.color = isDay ? "var(--gold)" : "var(--blue)";

        // Analemme Simple
        const cvs = document.getElementById('analemma-cvs'), ctx = cvs.getContext('2d');
        ctx.clearRect(0,0,cvs.width,cvs.height); ctx.strokeStyle="#222"; ctx.beginPath();
        for(let i=0; i<360; i+=10){
            ctx.lineTo(cvs.width/2 + Math.sin(i*Math.PI/180)*15, cvs.height/2 + Math.cos(i*Math.PI/180)*30);
        } ctx.stroke();
        ctx.fillStyle="var(--gold)"; ctx.beginPath();
        ctx.arc(cvs.width/2 + (eot * 2), cvs.height/2, 3, 0, 7); ctx.fill();
    }
};
</script>
</body>
</html>
