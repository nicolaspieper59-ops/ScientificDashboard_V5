<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>ARCHÈ X-13 | AR SOUVERAINE</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/decimal.js/10.4.3/decimal.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    <style>
        body { margin: 0; background: #000; color: #00ffcc; font-family: 'Courier New', monospace; overflow: hidden; }
        #video-bg { position: absolute; top: 0; left: 0; width: 100vw; height: 100vh; object-fit: cover; z-index: 0; filter: brightness(0.6) contrast(1.2); }
        #canvas-overlay { position: absolute; top: 0; left: 0; z-index: 2; pointer-events: none; }
        .hud-layer { position: absolute; z-index: 10; background: rgba(0, 10, 10, 0.7); border: 1px solid #00ffcc; padding: 10px; pointer-events: none; text-shadow: 0 0 5px #00ffcc; }
        #top-left { top: 10px; left: 10px; }
        #top-right { top: 10px; right: 10px; text-align: right; }
        #bottom-center { bottom: 20px; left: 50%; transform: translateX(-50%); width: 80%; text-align: center; font-size: 10px; }
        .crosshair { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 40px; height: 40px; border: 1px solid #ff3300; border-radius: 50%; z-index: 5; }
    </style>
</head>
<body>

<video id="video-bg" autoplay playsinline></video>
<canvas id="canvas-overlay"></canvas>
<div class="crosshair"></div>

<div id="top-left" class="hud-layer">
    <b>SENSORS: ARCHÈ X-13</b><br>
    PLANCK_SCALE: 1.616255e-35m<br>
    ECHO_FREQ: <span id="echo-val">0.00</span> Hz<br>
    COLLISION: <span id="coll-dist">N/A</span>
</div>

<div id="top-right" class="hud-layer">
    <b>STELLAR_MAP [0.001°]</b><br>
    AZIMUTH: <span id="star-pos">---</span><br>
    UFO_RADAR: <span id="ufo-status">SCANNING</span>
</div>

<div id="bottom-center" class="hud-layer">
    <b>VIRTUAL_BLACK_BOX_SOUVERAINE</b><br>
    <span id="hash-log">HASH_INIT...</span>
</div>

<script>
    Decimal.set({ precision: 70 });

    const ARCHE_X13 = {
        video: document.getElementById('video-bg'),
        canvas: document.getElementById('canvas-overlay'),
        ctx: null,
        audio: { context: null, analyser: null, data: null },

        async init() {
            // 1. Caméra (Réalité Augmentée)
            const stream = await navigator.mediaDevices.getUserMedia({ 
                video: { facingMode: "environment" }, 
                audio: true 
            });
            this.video.srcObject = stream;

            // 2. Audio (Écholocation)
            this.audio.context = new AudioContext();
            const source = this.audio.context.createMediaStreamSource(stream);
            this.audio.analyser = this.audio.context.createAnalyser();
            source.connect(this.audio.analyser);
            this.audio.data = new Uint8Array(this.audio.analyser.frequencyBinCount);

            // 3. Canvas
            this.ctx = this.canvas.getContext('2d');
            this.canvas.width = window.innerWidth;
            this.canvas.height = window.innerHeight;

            this.run();
        },

        run() {
            this.audio.analyser.getByteFrequencyData(this.audio.data);
            this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);

            // Calcul 256-bit pour la position stellaire
            let planckTime = new Decimal(Date.now()).mul('1.35e-43');
            let starAzimuth = new Decimal(Date.now()).mod(360).toDP(7);
            document.getElementById('star-pos').innerText = starAzimuth + "°";

            // Rendu de la mousse quantique (Écholocation)
            this.ctx.beginPath();
            this.ctx.strokeStyle = '#00ffcc';
            let sumFreq = 0;
            for(let i=0; i<this.audio.data.length; i+=8) {
                let v = this.audio.data[i] / 128.0;
                let x = i * (this.canvas.width / this.audio.data.length) * 8;
                let y = (v * this.canvas.height / 4) + (this.canvas.height / 1.5);
                this.ctx.lineTo(x, y);
                sumFreq += this.audio.data[i];
            }
            this.ctx.stroke();

            // Mise à jour Télémétrie
            document.getElementById('echo-val').innerText = (sumFreq/10).toFixed(2);
            let collision = new Decimal(sumFreq).mul('1.616e-35').mul(Math.pow(10, 32));
            document.getElementById('coll-dist').innerText = collision.toFixed(5) + " pm";

            // Scellage SHA-256
            let hash = CryptoJS.SHA256(starAzimuth.toString() + sumFreq).toString();
            document.getElementById('hash-log').innerText = "SHA-256: " + hash;

            requestAnimationFrame(() => this.run());
        }
    };

    document.body.onclick = () => ARCHE_X13.init();
</script>
</body>
</html>
